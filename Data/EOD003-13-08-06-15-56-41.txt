// EOD003-13-08-06-15-56-41.txt

LOCAL STRING CMD
LOCAL STRING RESP
LOCAL STRING SW

LOCAL STRING DATA
LOCAL STRING TEMP

LOCAL STRING SFI
LOCAL STRING REC
LOCAL STRING S_REC
LOCAL STRING E_REC

LOCAL STRING AIP
LOCAL STRING AFL
LOCAL STRING TEMP_AFL

LOCAL STRING ATC
LOCAL STRING RESP_AC1
LOCAL STRING IAD
LOCAL STRING CVR
LOCAL STRING AOSL
LOCAL STRING RESP_9F69
LOCAL STRING RESP_CERTI
LOCAL STRING RESP_HASH

LOCAL STRING RECOVERED
LOCAL STRING ICC_DYN_DATA
LOCAL STRING RESP_TRANS_HASH
LOCAL STRING CALC_TRANS_HASH
LOCAL STRING CID

LOCAL STRING SESK
LOCAL STRING CAC
LOCAL STRING ARQC
LOCAL STRING MAC
LOCAL STRING CALC_HASH

LOCAL STRING UDK "11223344006677881122334455007788"
LOCAL STRING MDK "8B4F854F0831FBF2635A212E4DDDB92A"
LOCAL STRING ENC "11220044556677881122330055667788"

LOCAL STRING FILE_KEY_A8 "15A912A5F029C6001DF2539A00137049"
LOCAL STRING FILE_KEY_B0 "167312850029B6001DC2539A0013E049"
LOCAL STRING FILE_KEY_B8 "191A5F026001DF259A03019C37049F11"
LOCAL STRING FILE_KEY_C8 "191A5F026001DF259A03019C37049F11"
LOCAL STRING FILE_KEY_F0 "191A5F026001DF259A03019C37049F11"

LOCAL STRING REC_KEY_A8 "A7F55DEA34B0EB9533F4850D95C0377A"
LOCAL STRING REC_KEY_B0 "A7F55DEA34B0EB9533F4850D95C0377A"
LOCAL STRING REC_KEY_C8 "A7F55DEA34B0EB9533F4850D95C0377A"
LOCAL STRING REC_KEY_F0 "A2F5213AA4B12B9633F4A81DBDC2C77B"

LOCAL STRING IV_TEMP
LOCAL STRING EN_KEY

LOCAL STRING N_768 "C5BD39EFF93AC495A771653D66341F660E8DF31237C0A28729661C45C9F4384CF26F687B69FB717C7595B4D26B533459BC1FC4367623654C29BAEF473FD085C191EC9626E579E2333322944AC7C31E850928FD8B098289DD917D3A288B7BDD55"
LOCAL STRING D_768 "1EFD63FA1F063DCEF27A0C12CE54B6E308BEE86C5F7E7A3A529BA52CAED4EE89E8A8DB2814590AD5259C7BC54A7AB4C660824E4372EF22AE813F2E0F0F5B4FE5D1CC52307F7DD97DF6885919F5FAC93D91D6522FDCA64B3A491BBFDD2662C255"
LOCAL STRING E_768 "000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000010001"

LOCAL STRING N_1024 "9DD730669F27892944A68C0C62344C0E8EC57C2AA78004B014C26A0B0F3B517A0B60D355DFBC8929BBC59CEBCD0CCA13CDAA0C94E91C84A26E7DBE6B58595C4EFF2D717CB9EB965C15D287AF60AC28D06BC51282BC4A518B0EA3ABA9343F1778545FFB49EE840BBCEA457DBAABBFD755BA0F943A08A59CFFB6066B4084767599"
LOCAL STRING D_1024 "0BCB45899580DDC5E0A45538A3A9E6B8FBC013EC1801FFD7AC656E890F054EAC40E7664337699E12293EB5E004BD5CE827E8F9F1B28D77F7AF2BE42B9F3966253EEA2862E0547BA78DC0DC9C5C875E82020382B93149907A524B5E420786F66377B50BBD17D5AD8B56BB1D972DFE455FE16875AC9036FDF3BBFC144CB5E25201"
LOCAL STRING E_1024 "0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000010001"

LOCAL STRING N_1152 "C345B4CD6FFC58E5C7ACFDFD6D0EA4EA9CEB288F30E5CAE9499D38A6FD0E378194A45A79E25E6DDE3DE5AA42584D450B350892B689F05E5B1A54B401CC9E486B43F6290A7C3863F3790EC4BBB34E078D7D98E247E89EFAB315C8F0A6E9B2A4802473C24800F16CF499D63F940099FA6B759F06226DE4A07C2E47A387D3A72A2FEB78028C04E5E903AC0BE73A7AF73FE5"
LOCAL STRING D_1152 "822E7888F552E5EE851DFEA8F35F189C689CC5B4CB43DC9B8668D06F535ECFABB86D91A696E99E942943C6D6E588D8B2235B0C79B14AE992118DCD568869859CD7F970B1A82597F67A4E5FB9B1BF6E1096942D3ECD2258A0D1CDD48BBB60E799B09BB0FA9A5A1A2E9B39BD379792AA0135C9E4C9D6D642366EDB452A5A4E8D3186F60747EB2B9C10A579B490C5985873"
LOCAL STRING E_1152 "000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003"

LOCAL STRING N_1280 "D01BE78B92643C6C3520AA59FD28084869F805E7FC94F42898699CA8970E50923C909625F45B40472B4295D6DA9423DB161BF5CEAB5806C02F7EC025B512AA321F6D68715A5FEEE6923F951434821D9B9231310C47319469F0D801463A00EA8B22225E3D333AB1718659F89DE4293F58D5CB541FE140CFD3E59E11E38C4BDCA2832F619951CAD777236D7CB77576C8E4C5F902F90F3849943D4C7D0F049479B9"
LOCAL STRING D_1280 "01BC6484B831388523E1A48A20F521DC8E1B10DC3687278CE47892634AF49B9CC7548D6C13A06490DE1382C720064C50EF8646D94A79EED47B90F06EB56BF51A25EE4BB3665AEBD5E5DD11E94691849DB1109CA39D6824218F08D7FD997E5EE282D37529F8B0D50D003DA6DE27145E12AD7F33B3775CBB1C05A0E35FE23EC0F5B5523CF8FB5492B9E74B8FF9CBF8E7DFD23AD697BD785B7F549674CC6BC89661"
LOCAL STRING E_1280 "00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000010001"

LOCAL STRING N_1408 "B231678044B98D5CF9DF30B9541E94C2BECD7352FC9D96F86D197518333E2D1D1AA584E12A1DEC60F11B3CD2AEB3630184FFFD3998E5C149862C5063149404E5C4FDB9FF30416B846BEF1F656BB40CF9092888AB904A2C7659A3F14CFC3F930532D869D014E669C533B763A88114156DC2061A5316780B173BD04BE8471E975EE318CA9D327BF28AEE954ECDC5B4C0FAD9EFCB659FE3C01E431F3440B3E0167DD5DCDE431E1378745DAE9D4C50432D7D"
LOCAL STRING D_1408 "76CB9A5583265E3DFBEA207B8D69B881D488F78CA8690F5048BBA365777EC8BE11C3ADEB71694840A0BCD3371F2242010355537BBB43D631041D8AECB862ADEE8353D154CAD647AD9D4A14EE47CD5DFB5B705B1D0ADC1DA31ECF91F87CAD95B0D5272581329781A0EECD9C1981354F71ACF7E1D8A4B338CEF08EB808835E9C5F71E32E1932024DB204A87A2E134650170848934899F163045B3FCC588E2C561F3260FF6033B33AEFA641B0AA9A52A693"
LOCAL STRING E_1408 "0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003"

LOCAL STRING N_1984 "97CF8BAD30CAE0F9A89285454DDDE967AAFBCD4BC0B78F29ECB1005286F15F6D7532A9C476607C73FF7424316DFC741894AA52EDBAF909719C7B53448343B45CF2F00A8ABFB78CEEBE848933AAED97DBE84F0730F34FB1AA1528D3D6EC75B73252A30D0C717518BE36458ADD0FBF854C65497F3F54084154B60F51561361EE8E85F742A54005524CB00FEBC334276E0E63DAD86C079A9A3DF5DD32BECADE1AB2B71F5F0A0E95A4000D01F1044A578AAD92E9FDE92E3C6AA3DCD4913DFA5552537E7DE75E241FAED455D76CB8FCAFEED3FD6DAB24D7A9C32852F866C751D7710F494A0DF11B67FAECDD87A9A4E2CC44F6F27E46E3C0CCCD0F"
LOCAL STRING D_1984 "194D41F232CC7AD446C3163637A4FC3BF1D4A2374AC94286FCC82AB86BD2E53CE8DDC6F613BABF68AA935B5D9254BE0418C70DD249D42C3D9A148DE0C08B48BA287D57171FF3ECD2751616DDF1D243F9FC0D2BDD7DE29D9C58DC234E7CBE49330DC5D78212E8D975090B9724D7F540E210E1953538AC0AE373AD3838C182F8DACD16829DD30E9698B309007E068BC76C44A7CE2113D6C7CEC6AC1B6FD27E53BF0082EB33AEBE02DC15B7942018420E0584224EBC6C49BDC0A9EF42210E363751AAC6F01165A57ED7DA3F9DFC1BEABBE6CBEE4F7253C7D3137996368D10E99D1FC187F6270856194E53E38E0CAD1439B9EA2CBEA4EE9077B3"
LOCAL STRING E_1984 "0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003"

DISP "----------------------------transaction1 start----------------------------"
// RESET
POWERON USERCARD RESP

// PBOC SELECT
GPSELECT USERCARD "A0000003330101" RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT


// GPO
APPEND CMD "80A8000021" "831F015600000000000200015642616E6B204361726420546573742043656E7465"
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT

LEFT TEMP RESP 2
JE TEMP "77" TAG_77_1

MID AIP RESP 5 4
MID AFL RESP 9

JMP TAG_77_END_1
TAG_77_1:

FINDTLV AIP "82" RESP
FINDTLV AFL "94" RESP
FINDTLV ATC "9F36" RESP
FINDTLV IAD "9F10" RESP
MID CVR IAD 7 8

TAG_77_END_1:


// 1st GAC
APPEND CMD "80AE800020" "0000000002000000000000000156000000000001560002291556410032E5DC2F"
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT

LEFT TEMP RESP 2
JE TEMP "77" TAG_77_2

MID ATC RESP 7 4
MID RESP_AC1 RESP 11 16
MID CVR RESP 33 8

JMP TAG_77_END_2
TAG_77_2:

FINDTLV AFL "9F36" RESP
FINDTLV RESP_AC1 "9F26" RESP
FINDTLV IAD "9F10" RESP

TAG_77_END_2:

NOT TEMP ATC
APPEND DATA "000000000000" ATC "000000000000" TEMP
CIPHER SESK DATA UDK TDES_ENC_ECB

APPEND TEMP "000000000200000000000000015600000000000156000229" "0032E5DC2F"
APPEND DATA TEMP AIP ATC CVR
PADDING DATA DATA PAD_ISO9797_M2
CIPHER CAC DATA SESK DES_TDES_MAC
COMPARE CAC RESP_AC1 0


// EXTERNAL AUTH
NOT TEMP ATC
APPEND DATA "000000000000" ATC "000000000000" TEMP
CIPHER SESK DATA UDK TDES_ENC_ECB

APPEND DATA "3030" "000000000000"
XOR DATA CAC DATA
APPEND DATA DATA "0000000000000000"
CIPHER ARQC DATA SESK TDES_ENC_ECB
LEFT ARQC ARQC 16
APPEND CMD "008200000A" ARQC "3030"
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT

// 2nd GAC
APPEND CMD "80AE400022" "30300000000002000000000000000156000000000001560002291556410032E5DC2F"
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT


// PUT DATA - 9F79
NOT TEMP ATC
APPEND DATA "000000000000" ATC "000000000000" TEMP
CIPHER SESK DATA MDK TDES_ENC_ECB
SET CMD "04DA9F790A"
APPEND DATA CMD ATC RESP_AC1 "000000001000"
PADDING DATA DATA PAD_ISO9797_M2
CIPHER MAC DATA SESK DES_TDES_MAC
LEFT MAC MAC 8
APPEND CMD CMD "000000001000" MAC
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT

DISP "----------------------------transaction2 start----------------------------"
// RESET
POWERON USERCARD RESP

// PBOC SELECT
GPSELECT USERCARD "A0000003330101" RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT


// GPO
APPEND CMD "80A8000021" "831F015601000000000200015642616E6B204361726420546573742043656E7465"
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT

LEFT TEMP RESP 2
JE TEMP "77" TAG_77_3

MID AIP RESP 5 4
MID AFL RESP 9

JMP TAG_77_END_3
TAG_77_3:

FINDTLV AIP "82" RESP
FINDTLV AFL "94" RESP
FINDTLV ATC "9F36" RESP
FINDTLV IAD "9F10" RESP
MID CVR IAD 7 8

TAG_77_END_3:


// GET DATA - 9F79
SET CMD "80CA9F7900"
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT

// GET DATA - 9F79
SET CMD "80CA9F7909"
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT

// GET DATA - 9F6D
SET CMD "80CA9F6D00"
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT

// GET DATA - 9F6D
SET CMD "80CA9F6D09"
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT

// VERIFY PIN
SET CMD "0020008008241234FFFFFFFFFF"
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT

// 1st GAC
APPEND CMD "80AE900020" "0000000002000000000000000156000000000001560002291556430032E5DC2F"
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT

LEFT TEMP RESP 2
JE TEMP "77" TAG_77_4

MID ATC RESP 7 4
MID RESP_AC1 RESP 11 16
MID CVR RESP 33 8

JMP TAG_77_END_4
TAG_77_4:

FINDTLV ATC "9F36" RESP
FINDTLV RESP_AC1 "9F26" RESP
FINDTLV IAD "9F10" RESP
MID CVR IAD 7 8
FINDTLV CID "9F27" RESP

FINDTLV RESP_CERTI "9F4B" RESP

TAG_77_END_4:

JE RESP_CERTI "" L_EMPTY_CERTI

RSA RECOVERED RESP_CERTI N_1152 E_1152 RSA_ENC
DISP RECOVERED

MID TEMP RECOVERED 3 2
COMPARE TEMP "05" 0

RIGHT TEMP RECOVERED 2
COMPARE TEMP "BC" 0

MID TEMP RECOVERED 7 2
COMPARE TEMP "20" 0

MID ICC_DYN_DATA RECOVERED 9 64

MID RESP_AC1 ICC_DYN_DATA 9 16

MID RESP_TRANS_HASH ICC_DYN_DATA 25 40

SLEN TEMP IAD
APPEND CALC_TRANS_HASH "015601000000000200015642616E6B204361726420546573742043656E7465" "0000000002000000000000000156000000000001560002291556430032E5DC2F" "9F2701" CID "9F3602" ATC "9F10" TEMP
HASH CALC_TRANS_HASH CALC_TRANS_HASH SHA1
COMPARE CALC_TRANS_HASH RESP_TRANS_HASH 0

MID CVR IAD 7 8
COMPARE CVR "03A40002" 0

RIGHT RESP_HASH RECOVERED 42
LEFT RESP_HASH RESP_HASH 40

APPEND TEMP "05012002" ATC CID RESP_AC1 CALC_TRANS_HASH "BBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBB" "32E5DC2F"
DISP TEMP
HASH CALC_HASH TEMP SHA1
COMPARE RESP_HASH CALC_HASH 0

L_EMPTY_CERTI:

NOT TEMP ATC
APPEND DATA "000000000000" ATC "000000000000" TEMP
CIPHER SESK DATA UDK TDES_ENC_ECB

APPEND TEMP "000000000200000000000000015600000000000156000229" "0032E5DC2F"
APPEND DATA TEMP AIP ATC CVR
PADDING DATA DATA PAD_ISO9797_M2
CIPHER CAC DATA SESK DES_TDES_MAC
COMPARE CAC RESP_AC1 0


// EXTERNAL AUTH
NOT TEMP ATC
APPEND DATA "000000000000" ATC "000000000000" TEMP
CIPHER SESK DATA UDK TDES_ENC_ECB

APPEND DATA "3030" "000000000000"
XOR DATA CAC DATA
APPEND DATA DATA "0000000000000000"
CIPHER ARQC DATA SESK TDES_ENC_ECB
LEFT ARQC ARQC 16
APPEND CMD "008200000A" ARQC "3030"
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT

// 2nd GAC
APPEND CMD "80AE500022" "30300000000002000000000000000156000000000001560002291556440032E5DC2F"
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT

LEFT TEMP RESP 2
JE TEMP "77" TAG_77_5

MID ATC RESP 7 4
MID RESP_AC1 RESP 11 16
MID CVR RESP 33 8

JMP TAG_77_END_5
TAG_77_5:

FINDTLV ATC "9F36" RESP
FINDTLV RESP_AC1 "9F26" RESP
FINDTLV IAD "9F10" RESP
MID CVR IAD 7 8
FINDTLV CID "9F27" RESP

FINDTLV RESP_CERTI "9F4B" RESP

TAG_77_END_5:

JE RESP_CERTI "" L_EMPTY_CERTI_1

RSA RECOVERED RESP_CERTI N_1152 E_1152 RSA_ENC
DISP RECOVERED

MID TEMP RECOVERED 3 2
COMPARE TEMP "05" 0

RIGHT TEMP RECOVERED 2
COMPARE TEMP "BC" 0

MID TEMP RECOVERED 7 2
COMPARE TEMP "20" 0

MID ICC_DYN_DATA RECOVERED 9 64

MID RESP_AC1 ICC_DYN_DATA 9 16

MID RESP_TRANS_HASH ICC_DYN_DATA 25 40

SLEN TEMP IAD
APPEND CALC_TRANS_HASH "015601000000000200015642616E6B204361726420546573742043656E7465" "0000000002000000000000000156000000000001560002291556430032E5DC2F" "30300000000002000000000000000156000000000001560002291556440032E5DC2F" "9F2701" CID "9F3602" ATC "9F10" TEMP
HASH CALC_TRANS_HASH CALC_TRANS_HASH SHA1
COMPARE CALC_TRANS_HASH RESP_TRANS_HASH 0

RIGHT RESP_HASH RECOVERED 42
LEFT RESP_HASH RESP_HASH 40

APPEND TEMP "05012002" ATC CID RESP_AC1 CALC_TRANS_HASH "BBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBB" "32E5DC2F"
DISP TEMP
HASH CALC_HASH TEMP SHA1
COMPARE RESP_HASH CALC_HASH 0

L_EMPTY_CERTI_1:


ERROR_SCRIPT:
