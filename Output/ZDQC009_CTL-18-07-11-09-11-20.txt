LOCAL STRING CMD
LOCAL STRING RESP
LOCAL STRING SW
LOCAL STRING DATA
LOCAL STRING TEMP
LOCAL STRING AID
LOCAL STRING AIP
LOCAL STRING AFL
LOCAL STRING CID
LOCAL STRING ATC
LOCAL STRING PDOL_DATA
LOCAL STRING CDOL1_DATA
LOCAL STRING CDOL2_DATA
LOCAL STRING RESP_AC1
LOCAL STRING RESP_AC2
LOCAL STRING CAC
LOCAL STRING IAD
LOCAL STRING CVR
LOCAL STRING AOSA
LOCAL STRING SESK
LOCAL STRING CALCULATED_AC
LOCAL STRING ARQC
LOCAL STRING MAC
LOCAL STRING UDK "11223344006677881122334455007788"
LOCAL STRING MDK "8B4F854F0831FBF2635A212E4DDDB92A"
LOCAL STRING ENC "11223344006677881122334455007788"
LOCAL STRING AID_PSE "315041592E5359532E4444463031"
LOCAL STRING AID_PPSE "325041592E5359532E4444463031"
LOCAL STRING AID_PBOC "A0000003330101"
LOCAL STRING ELFAID
LOCAL STRING EMAID
LOCAL STRING INSTANCEAID
LOCAL STRING PRIV
LOCAL STRING INSTALL_PARAM
LOCAL STRING HRN "0000000000000000"
LOCAL STRING ISD_MK "404142434445464748494A4B4C4D4E4F404142434445464748494A4B4C4D4E4F404142434445464748494A4B4C4D4E4F"
LOCAL NUMERIC P2

// =======================================transaction 1=======================================
// RESET
POWERON USERCARD RESP
SET P2 0

// SELECT ISD
SET AID "A000000003000000"
GPSELECT USERCARD AID RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT


// Mutual Auth
GPSETDESKEY ISD_MK
GPMUTUALAUTH USERCARD 0 HRN 1 RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT


// DELETE PSE
GPDELETE USERCARD 0x00 "315041592E5359532E4444463031" RESP SW "9000" "6A88"

// DELETE PPSE
GPDELETE USERCARD 0x00 "325041592E5359532E4444463031" RESP SW "9000" "6A88"

// DELETE PBOC
GPDELETE USERCARD 0x00 "A0000003330101" RESP SW "9000" "6A88"

// DELETE A000000333010108
GPDELETE USERCARD 0x00 "A000000333010108" RESP SW "9000" "6A88"

// DELETE A000000333010102
GPDELETE USERCARD 0x00 "A000000333010102" RESP SW "9000" "6A88"

// DELETE A000000333010101
GPDELETE USERCARD 0x00 "A000000333010101" RESP SW "9000" "6A88"

// DELETE PBOC
GPDELETE USERCARD 0x00 "A0000003330101" RESP SW "9000" "6A88"

// INSTALL PBOC
SET ELFAID "A00000033301"
SET EMAID "A0000003330101"
SET INSTANCEAID "A0000003330101"
SET INSTALL_PARAM "1408"
GPINSTALLFORINSTALL USERCARD ELFAID EMAID INSTANCEAID 0x10 INSTALL_PARAM "" RESP SW "9000"

// SELECT PBOC
SET AID "A0000003330101"
GPSELECT USERCARD AID RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT


// Mutual Auth
GPSETDESKEY ISD_MK
GPMUTUALAUTH USERCARD 0 HRN 1 RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT

SET DATA "910252A550500B50424F43204372656469748701019F380F9F1A029F7A019F02065F2A029F4E145F2D087A68656E667264659F1101019F120F4341524420494D414745203030333EBF0C0A9F4D020B0ADF4D020C0A"
GPSTOREDATA USERCARD 0x00 P2 DATA RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT
ADD P2 P2 1

SET DATA "910353A551500B50424F43204372656469748701019F380C9F66049F02069F37045F2A025F2D087A68656E667264659F1101019F120F4341524420494D414745203030333EBF0C0EDF6101109F4D020B0ADF4D020C0A"
GPSTOREDATA USERCARD 0x00 P2 DATA RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT
ADD P2 P2 1

SET DATA "91041682027C00941008010200080505011003070020010100"
GPSTOREDATA USERCARD 0x00 P2 DATA RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT
ADD P2 P2 1

SET DATA "92031A82027C0094140801020008030401100304001008090020010100"
GPSTOREDATA USERCARD 0x00 P2 DATA RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT
ADD P2 P2 1

SET DATA "92072382027C009410080505011003070020010100280303009F100A07011703000000010A01"
GPSTOREDATA USERCARD 0x00 P2 DATA RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT
ADD P2 P2 1

SET DATA "92000D9F100A07010103000000010A01"
GPSTOREDATA USERCARD 0x00 P2 DATA RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT
ADD P2 P2 1

SET DATA "800030112233440066778811223344550077888B4F854F0831FBF2635A212E4DDDB92A11220044556677881122330055667788"
GPSTOREDATA USERCARD 0x60 P2 DATA RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT
ADD P2 P2 1

SET DATA "90000997DCB0CE4E2CB37DF3"
GPSTOREDATA USERCARD 0x00 P2 DATA RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT
ADD P2 P2 1

SET DATA "801008241234FFFFFFFFFF"
GPSTOREDATA USERCARD 0x60 P2 DATA RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT
ADD P2 P2 1

SET DATA "9010020303"
GPSTOREDATA USERCARD 0x00 P2 DATA RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT
ADD P2 P2 1

SET DATA "01012E702C57116228000100001117D301220101234567899F1F1630313032303330343035303630373038303930413042"
GPSTOREDATA USERCARD 0x00 P2 DATA RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT
ADD P2 P2 1

SET DATA "01021870165F200F46554C4C2046554E4354494F4E414C5F340101"
GPSTOREDATA USERCARD 0x00 P2 DATA RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT
ADD P2 P2 1

SET DATA "010381707F8E0A000000000000000001009F0D057C70B808009F0E057C70B808009F0F0500000000005F25039507015F24033012315A0862280001000011179F080200309F0702FFC05F280201568C189F02069F03069F1A0295055F2A029A039F21039C019F37048D1A8A029F02069F03069F1A0295055F2A029A039F21039C019F3704"
GPSTOREDATA USERCARD 0x00 P2 DATA RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT
ADD P2 P2 1

SET DATA "01043870369F74064543433131319F482A6CF499D63F940099FA6B759F06226DE4A07C2E47A387D3A72A2FEB78028C04E5E903AC0BE73A7AF73FE5"
GPSTOREDATA USERCARD 0x00 P2 DATA RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT
ADD P2 P2 1

SET DATA "01051D701B5A0862280001000011175F24033012315F25039507019F08020030"
GPSTOREDATA USERCARD 0x00 P2 DATA RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT
ADD P2 P2 1

SET DATA "0203967081939081907958064ECCBBF90B89D4D9FE6FA8286654A697EAD27575D20C0D39D4AFA0C4AA2AD7B6CC7413F69B9D3EA835701C0AA93228495F1F08703AF46BFB0191FB7F03DF4296C797B874A1F9C40EA7B0290268FB041CC83EE2E86415C6E307B391DE90CED3BBFD7856218D274CF82B16614C9570F326680A71649F1C618C0DB351D8406F94192F53D2DBF1A3DD1DD0EEFA116A"
GPSTOREDATA USERCARD 0x00 P2 DATA RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT
ADD P2 P2 1

SET DATA "02044370418F01839224DA7D9ED0CB4FB9A1182967B17314701AC51969D44B85798C8ECE039CD0C11714E9CC19EB9F4701039F3201039F49039F37049F420201565F30020201"
GPSTOREDATA USERCARD 0x00 P2 DATA RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT
ADD P2 P2 1

SET DATA "0205A070819D8E120000000000000000410342035E0343031F009F0D05F0200400009F0E0500508800009F0F05F0200498009F0702FFC05F280201568C189F02069F03069F1A0295055F2A029A039F21039C019F37048D1A8A029F02069F03069F1A0295055F2A029A039F21039C019F37049F4A01829F482A6CF499D63F940099FA6B759F06226DE4A07C2E47A387D3A72A2FEB78028C04E5E903AC0BE73A7AF73FE5"
GPSTOREDATA USERCARD 0x00 P2 DATA RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT
ADD P2 P2 1

SET DATA "020696708193938190512617C7300B6F161E0278D466F52A21ED37BB5AA2240E7A50CE47FC712968945161FE94B4B60EAA5B74765355C212C4A747EA2C11A19E8B06DBBB65D7EAC1AA55D5F179A745C75BDAB88B9DE372A9EB36FA66E35B388006F54B2B1E085BC1D752C83FF596CD360AC6C4BAD92DF752862EE38CACFA7E089E3D7C247C66466DB6F12E4BD70EEB850A9CE3B531B22F2700"
GPSTOREDATA USERCARD 0x00 P2 DATA RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT
ADD P2 P2 1

SET DATA "0207977081949F4681905B79FF131780D600CB48B44A2AF7F7B7A69500E82EC72C93E385DEC28F243F7C2868F6C1986097F967881280E9F871C5B1E14C2DE127A0444C9669EEAA54AE1E07427741CF3BC8836328C455ED17DCFFC61AE45BF056F44C7CD3420FB8A4E5FBC7EB6F6244F7B114D9C8431039E9AC9D6D277864D487C7C5B0E2B810F251BB5A7AB8797CCAE2825A51846A53F3ADE6CC"
GPSTOREDATA USERCARD 0x00 P2 DATA RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT
ADD P2 P2 1

SET DATA "0208967081939381905F43D82363EFCD7EBEBAE2A195EA69933A1602DF210EA3983AEDA10791FD1E54F23C492F05414DEBE2BD0392E9E2BA9908BEF61730CDD6B28A7E228713544815645ACC82613FFF80EF093F39593AAA55E6FADD2275AF7C48148BA65F875B46F43D2D6486EC6E72581A16A79DEC16E26931DE5E9BA14BF47FBC43939E3F4A9EDE65D5A9457C8BF2658435488C9E6CE979"
GPSTOREDATA USERCARD 0x00 P2 DATA RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT
ADD P2 P2 1

SET DATA "0209977081949F4681902D631D72B8628D29938AB90B61AB180734FF81A37CDE4ECE61E793AAB8623F87F2A794D786C3B210293C4773357E3376F046E16FB46BAB1795AABCAF40C0935559248ABF3D2C803862DB446531B9E78C5D89D5E3A00A62865A264332B0F8AAF4FF42D9B1A94351B79B817620934B951CEC68ABBEDC29901957F6C7E77DDECC5DA21F77B3A8A0AB1E9CDE3EED49681E19"
GPSTOREDATA USERCARD 0x00 P2 DATA RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT
ADD P2 P2 1

SET DATA "04013D703B9F1401039F2301079F241D11223344556677889900112233445566778899001122334455667788999F631011223344556677880000000000000000"
GPSTOREDATA USERCARD 0x00 P2 DATA RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT
ADD P2 P2 1

SET DATA "05031670149F74064543433131319F69080100000000000000"
GPSTOREDATA USERCARD 0x00 P2 DATA RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT
ADD P2 P2 1

SET DATA "0D018D9F5801039F5901079F5301039F7201009F54060000000100009F77060000000150009F78060000000010009F79060000000100009F6B060000000005009F6D060000000015009F6804831040009F6C0230009F5D06000000000001DF71020344DF7206000000000500DF7606000000003000DF7706000000030000DF7806000000002000DF7906000000020000"
GPSTOREDATA USERCARD 0x00 P2 DATA RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT
ADD P2 P2 1

SET DATA "0E01AD9F130200009F241D11223344556677889900112233445566778899001122334455667788999F510201569F520282429F5601009F570201569F7602000057116228000100001117D301220101234567895F200F46554C4C2046554E4354494F4E414C5F3401019F6310112233445566778800000000000000009F360200009F4F199A039F21039F02069F03069F1A025F2A029F4E149C019F3602DF4F109A039F21039F1A029F4E149C019F3602"
GPSTOREDATA USERCARD 0x00 P2 DATA RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT
ADD P2 P2 1

SET DATA "82015055FC824EF4466D5C0FAE99FE250633410E762A8402F6CF6F0C71CACCC9D16A9652E2CC74F546445C6B9DFD33F5D699799F8CD7908CBC03E9DE6A350B75A2165FD73782B8B03090098000000000000000"
GPSTOREDATA USERCARD 0x60 P2 DATA RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT
ADD P2 P2 1

SET DATA "820250864D85A3A14785C8648B6C1C74F82A7708EBA9A3A6BC666D2B51D8FB78C28827B452364F3E128FE0E919CD56B46F74D926566EB435054B54F0855AC22062EE4B7A56BA448F101CB78000000000000000"
GPSTOREDATA USERCARD 0x60 P2 DATA RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT
ADD P2 P2 1

SET DATA "820350A56DF31FCF2D1130034652D4AE4F795F8921CCEA8F0474F93C5FA239ED8450F76C5836DBD56C17BADA30FCA11352B3EDDEFE0E7BFDC643997AD49FA8A26010FBA83780A6FD51B56F8000000000000000"
GPSTOREDATA USERCARD 0x60 P2 DATA RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT
ADD P2 P2 1

SET DATA "820450C974487571EB48AC96D1222AAF743FB28D617E757A1A99A3C0FAC5793523CC3B8E7B5176DD1BD7D15DA6B4020EA72F45B981A60E4F87F0FF68C808233094657137821766D6982B138000000000000000"
GPSTOREDATA USERCARD 0x60 P2 DATA RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT
ADD P2 P2 1

SET DATA "820550F824ECAFB6C399C804E97C3F0577360F4DB2B35FD686AF75DA8F7356E446797322845249C022239847497AF19CFC0DE4CE7D15B9FCA96566383EEF7CF39019797C5340FA7BFA90278000000000000000"
GPSTOREDATA USERCARD 0xE0 P2 DATA RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT
ADD P2 P2 1

// =======================================transaction 2=======================================
// RESET
POWERON USERCARD RESP
SET P2 0

// SELECT ISD
SET AID "A000000003000000"
GPSELECT USERCARD AID RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT


// Mutual Auth
GPSETDESKEY ISD_MK
GPMUTUALAUTH USERCARD 0 HRN 1 RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT

// DELETE PSE
GPDELETE USERCARD 0x00 "315041592E5359532E4444463031" RESP SW "9000" "6A88"

// INSTALL PSE
SET ELFAID "315041592E"
SET EMAID "315041592E5359532E4444463031"
SET INSTANCEAID "315041592E5359532E4444463031"
SET INSTALL_PARAM ""
GPINSTALLFORINSTALL USERCARD ELFAID EMAID INSTANCEAID 0x00 INSTALL_PARAM "" RESP SW "9000"

// SELECT PSE
SET AID "315041592E5359532E4444463031"
GPSELECT USERCARD AID RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT


// Mutual Auth
GPSETDESKEY ISD_MK
GPMUTUALAUTH USERCARD 0 HRN 1 RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT

SET DATA "910214A5128801015F2D087A68656E667264659F110101"
GPSTOREDATA USERCARD 0x00 P2 DATA RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT
ADD P2 P2 1

SET DATA "01011D701B61194F07A0000003330101500B50424F4320437265646974870101"
GPSTOREDATA USERCARD 0x80 P2 DATA RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT
ADD P2 P2 1

// =======================================transaction 3=======================================
// RESET
POWERON USERCARD RESP
SET P2 0

// SELECT ISD
SET AID "A000000003000000"
GPSELECT USERCARD AID RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT


// Mutual Auth
GPSETDESKEY ISD_MK
GPMUTUALAUTH USERCARD 0 HRN 1 RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT

// DELETE PPSE
GPDELETE USERCARD 0x00 "325041592E5359532E4444463031" RESP SW "9000" "6A88"

// INSTALL PPSE
SET ELFAID "315041592E"
SET EMAID "315041592E5359532E4444463031"
SET INSTANCEAID "325041592E5359532E4444463031"
SET INSTALL_PARAM ""
GPINSTALLFORINSTALL USERCARD ELFAID EMAID INSTANCEAID 0x00 INSTALL_PARAM "" RESP SW "9000"

// SELECT PPSE
SET AID "325041592E5359532E4444463031"
GPSELECT USERCARD AID RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT


// Mutual Auth
GPSETDESKEY ISD_MK
GPMUTUALAUTH USERCARD 0 HRN 1 RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT

SET DATA "910220A51EBF0C1B61194F07A0000003330101500B50424F4320437265646974870101"
GPSTOREDATA USERCARD 0x80 P2 DATA RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT
ADD P2 P2 1

// =======================================transaction 4=======================================
// RESET
POWERON USERCARD RESP
SET P2 0

// SELECT PPSE
SET AID "325041592E5359532E4444463031"
GPSELECT USERCARD AID RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT

// SELECT PBOC
SET AID "A0000003330101"
GPSELECT USERCARD AID RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT

// GPO
SET PDOL_DATA "8310F6000000000000000200A8EBC59C0156"
APPEND CMD "80A8000012" PDOL_DATA
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT

LEFT TEMP RESP 2
JE TEMP "77" TRANSACTION4_GPO_RESPONSE_TAG_77
MID AIP RESP 5 4
MID AFL RESP 9
JMP TRANSACTION4_GPO_RESPONSE_TAG_77_END
TRANSACTION4_GPO_RESPONSE_TAG_77:

FINDTLV AIP "82" RESP
FINDTLV AFL "94" RESP
FINDTLV ATC "9F36" RESP
FINDTLV IAD "9F10" RESP
MID CVR IAD 7 8
TRANSACTION4_GPO_RESPONSE_TAG_77_END:

// Get Data
SET CMD "80CA9F5200"
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT
FINDTLV RESP "9F52" RESP

// Get Data
SET CMD "80CA9F5600"
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT
FINDTLV RESP "9F56" RESP

// =======================================transaction 5=======================================
// RESET
POWERON USERCARD RESP
SET P2 0

// SELECT PPSE
SET AID "325041592E5359532E4444463031"
GPSELECT USERCARD AID RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT

// SELECT PBOC
SET AID "A0000003330101"
GPSELECT USERCARD AID RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT

// Get Data
SET CMD "80CA9F7700"
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT
FINDTLV RESP "9F77" RESP

// Get Data
SET CMD "80CA9F7800"
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT
FINDTLV RESP "9F78" RESP

// Get Data
SET CMD "80CA9F7900"
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT
FINDTLV RESP "9F79" RESP

// Get Data
SET CMD "80CA9F6B00"
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT
FINDTLV RESP "9F6B" RESP

// Get Data
SET CMD "80CA9F6D00"
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT
FINDTLV RESP "9F6D" RESP

// Get Data
SET CMD "80CA9F5D00"
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT
FINDTLV RESP "9F5D" RESP

// GPO
SET PDOL_DATA "8310F6000000000000000200A8EBC59C0156"
APPEND CMD "80A8000012" PDOL_DATA
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT

LEFT TEMP RESP 2
JE TEMP "77" TRANSACTION5_GPO_RESPONSE_TAG_77
MID AIP RESP 5 4
MID AFL RESP 9
JMP TRANSACTION5_GPO_RESPONSE_TAG_77_END
TRANSACTION5_GPO_RESPONSE_TAG_77:

FINDTLV AIP "82" RESP
FINDTLV AFL "94" RESP
FINDTLV ATC "9F36" RESP
FINDTLV IAD "9F10" RESP
MID CVR IAD 7 8
TRANSACTION5_GPO_RESPONSE_TAG_77_END:

// Read Record
SET CMD "00B2010C00"
SENDAPDU USERCARD CMD RESP SW "9000"

// Read Record
SET CMD "00B2020C00"
SENDAPDU USERCARD CMD RESP SW "9000"

// Read Record
SET CMD "00B2050C00"
SENDAPDU USERCARD CMD RESP SW "9000"

// Read Record
SET CMD "00B2031400"
SENDAPDU USERCARD CMD RESP SW "9000"

// Read Record
SET CMD "00B2041400"
SENDAPDU USERCARD CMD RESP SW "9000"

// Read Record
SET CMD "00B2051400"
SENDAPDU USERCARD CMD RESP SW "9000"

// Read Record
SET CMD "00B2061400"
SENDAPDU USERCARD CMD RESP SW "9000"

// Read Record
SET CMD "00B2071400"
SENDAPDU USERCARD CMD RESP SW "9000"

// Read Record
SET CMD "00B2012400"
SENDAPDU USERCARD CMD RESP SW "9000"

// Get Data
SET CMD "80CA9F1700"
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT
FINDTLV RESP "9F17" RESP

// Verify Pin
APPEND CMD "0020008008" "241234FFFFFFFFFF"
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT

// 1st Generate AC
SET CDOL1_DATA "00000000020000000000000001560000000000015618071109113600A8EBC59C"
APPEND CMD "80AE800020" CDOL1_DATA
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT

LEFT TEMP RESP 2
JE TEMP "77" TRANSACTION5_1st_GENERATE_AC_TAG_77
MID ATC RESP 7 4
MID RESP_AC1 RESP 11 16
MID CVR RESP 33 8

JMP TRANSACTION5_1st_GENERATE_AC_TAG_77_END
TRANSACTION5_1st_GENERATE_AC_TAG_77:
FINDTLV ATC "9F36" RESP
FINDTLV RESP_AC1 "9F36" RESP
FINDTLV IAD "9F36" RESP
TRANSACTION5_1st_GENERATE_AC_TAG_77_END:

NOT TEMP ATC
APPEND DATA "000000000000" ATC "000000000000" TEMP
CIPHER SESK DATA UDK TDES_ENC_ECB

APPEND TEMP "000000000200000000000000015600000000000156180711" "00A8EBC59C"
APPEND DATA TEMP AIP ATC CVR
PADDING DATA DATA PAD_ISO9797_M2
CIPHER CAC DATA SESK DES_TDES_MAC
COMPARE CAC RESP_AC1 0

// External Authenticate
NOT TEMP ATC
APPEND DATA "000000000000" ATC "000000000000" TEMP
CIPHER SESK DATA UDK TDES_ENC_ECB
APPEND DATA "3030" "000000000000"
XOR DATA CAC DATA
APPEND DATA DATA "0000000000000000"
CIPHER ARQC DATA SESK TDES_ENC_ECB
LEFT ARQC ARQC 16
APPEND CMD "008200000A" ARQC "3030"
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT

// 2nd Generate AC
SET CDOL2_DATA "303000000000020000000000000001560000000000015618071109113600A8EBC59C"
APPEND CMD "80AE400022" CDOL2_DATA
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT

LEFT TEMP RESP 2
JE TEMP "77" TRANSACTION5_2nd_GENERATE_AC_TAG_77
MID ATC RESP 7 4
MID RESP_AC2 RESP 11 16
MID CVR RESP 33 8

JMP TRANSACTION5_2nd_GENERATE_AC_TAG_77_END
TRANSACTION5_2nd_GENERATE_AC_TAG_77:
FINDTLV ATC "9F36" RESP
FINDTLV RESP_AC2 "9F36" RESP
FINDTLV IAD "9F36" RESP
TRANSACTION5_2nd_GENERATE_AC_TAG_77_END:

APPEND TEMP "000000000200000000000000015600000000000156180711" "00A8EBC59C"
APPEND DATA TEMP AIP ATC CVR
PADDING DATA DATA PAD_ISO9797_M2
CIPHER CAC DATA SESK DES_TDES_MAC
COMPARE CAC RESP_AC2 0

// Make Session Key
NOT TEMP ATC
APPEND DATA "000000000000" ATC "000000000000" TEMP
CIPHER SESK DATA MDK TDES_ENC_ECB
// Put Data
SET CMD "04DADF6105"
APPEND DATA CMD ATC RESP_AC1 "10"
PADDING DATA DATA PAD_ISO9797_M2
CIPHER MAC DATA SESK DES_TDES_MAC
LEFT MAC MAC 8
APPEND CMD CMD "10" MAC
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT

// Get Data
SET CMD "80CADF6100"
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT
FINDTLV RESP "DF61" RESP

// Get Data
SET CMD "80CA9F7700"
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT
FINDTLV RESP "9F77" RESP

// Get Data
SET CMD "80CA9F7800"
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT
FINDTLV RESP "9F78" RESP

// Get Data
SET CMD "80CA9F7900"
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT
FINDTLV RESP "9F79" RESP

// Get Data
SET CMD "80CA9F6B00"
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT
FINDTLV RESP "9F6B" RESP

// Get Data
SET CMD "80CA9F6D00"
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT
FINDTLV RESP "9F6D" RESP

// Get Data
SET CMD "80CADF7700"
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT
FINDTLV RESP "DF77" RESP

// Get Data
SET CMD "80CADF7800"
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT
FINDTLV RESP "DF78" RESP

// Get Data
SET CMD "80CADF7900"
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT
FINDTLV RESP "DF79" RESP

// Get Data
SET CMD "80CADF7200"
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT
FINDTLV RESP "DF72" RESP

// Get Data
SET CMD "80CADF7600"
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT
FINDTLV RESP "DF76" RESP

// =======================================transaction 6=======================================
// RESET
POWERON USERCARD RESP
SET P2 0

// SELECT PPSE
SET AID "325041592E5359532E4444463031"
GPSELECT USERCARD AID RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT

// SELECT PBOC
SET AID "A0000003330101"
GPSELECT USERCARD AID RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT

// GPO
SET PDOL_DATA "831026000080000000000200A8EBC5920156"
APPEND CMD "80A8000012" PDOL_DATA
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT

LEFT TEMP RESP 2
JE TEMP "77" TRANSACTION6_GPO_RESPONSE_TAG_77
MID AIP RESP 5 4
MID AFL RESP 9
JMP TRANSACTION6_GPO_RESPONSE_TAG_77_END
TRANSACTION6_GPO_RESPONSE_TAG_77:

FINDTLV AIP "82" RESP
FINDTLV AFL "94" RESP
FINDTLV ATC "9F36" RESP
FINDTLV IAD "9F10" RESP
MID CVR IAD 7 8
TRANSACTION6_GPO_RESPONSE_TAG_77_END:

// Read Record
SET CMD "00B2011C00"
SENDAPDU USERCARD CMD RESP SW "9000"

// Read Record
SET CMD "00B2050C00"
SENDAPDU USERCARD CMD RESP SW "9000"

// Read Record
SET CMD "00B2031400"
SENDAPDU USERCARD CMD RESP SW "9000"

// Read Record
SET CMD "00B2041400"
SENDAPDU USERCARD CMD RESP SW "9000"

// Read Record
SET CMD "00B2051400"
SENDAPDU USERCARD CMD RESP SW "9000"

// Read Record
SET CMD "00B2061400"
SENDAPDU USERCARD CMD RESP SW "9000"

// Read Record
SET CMD "00B2071400"
SENDAPDU USERCARD CMD RESP SW "9000"

// Read Record
SET CMD "00B2012400"
SENDAPDU USERCARD CMD RESP SW "9000"

// Read Record
SET CMD "00B2032C00"
SENDAPDU USERCARD CMD RESP SW "9000"

// =======================================transaction 7=======================================
// RESET
POWERON USERCARD RESP
SET P2 0

// SELECT PPSE
SET AID "325041592E5359532E4444463031"
GPSELECT USERCARD AID RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT

// SELECT PBOC
SET AID "A0000003330101"
GPSELECT USERCARD AID RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT

// Get Data
SET CMD "80CA9F7700"
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT
FINDTLV RESP "9F77" RESP

// Get Data
SET CMD "80CA9F7800"
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT
FINDTLV RESP "9F78" RESP

// Get Data
SET CMD "80CA9F7900"
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT
FINDTLV RESP "9F79" RESP

// Get Data
SET CMD "80CA9F6B00"
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT
FINDTLV RESP "9F6B" RESP

// Get Data
SET CMD "80CA9F6D00"
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT
FINDTLV RESP "9F6D" RESP

// Get Data
SET CMD "80CA9F5D00"
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT
FINDTLV RESP "9F5D" RESP

// GPO
SET PDOL_DATA "8310F6000000000000000200A8EBC5930156"
APPEND CMD "80A8000012" PDOL_DATA
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT

LEFT TEMP RESP 2
JE TEMP "77" TRANSACTION7_GPO_RESPONSE_TAG_77
MID AIP RESP 5 4
MID AFL RESP 9
JMP TRANSACTION7_GPO_RESPONSE_TAG_77_END
TRANSACTION7_GPO_RESPONSE_TAG_77:

FINDTLV AIP "82" RESP
FINDTLV AFL "94" RESP
FINDTLV ATC "9F36" RESP
FINDTLV IAD "9F10" RESP
MID CVR IAD 7 8
TRANSACTION7_GPO_RESPONSE_TAG_77_END:

// Read Record
SET CMD "00B2010C00"
SENDAPDU USERCARD CMD RESP SW "9000"

// Read Record
SET CMD "00B2020C00"
SENDAPDU USERCARD CMD RESP SW "9000"

// Read Record
SET CMD "00B2050C00"
SENDAPDU USERCARD CMD RESP SW "9000"

// Read Record
SET CMD "00B2031400"
SENDAPDU USERCARD CMD RESP SW "9000"

// Read Record
SET CMD "00B2041400"
SENDAPDU USERCARD CMD RESP SW "9000"

// Read Record
SET CMD "00B2051400"
SENDAPDU USERCARD CMD RESP SW "9000"

// Read Record
SET CMD "00B2061400"
SENDAPDU USERCARD CMD RESP SW "9000"

// Read Record
SET CMD "00B2071400"
SENDAPDU USERCARD CMD RESP SW "9000"

// Read Record
SET CMD "00B2012400"
SENDAPDU USERCARD CMD RESP SW "9000"

// Get Data
SET CMD "80CA9F1700"
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT
FINDTLV RESP "9F17" RESP

// Verify Pin
APPEND CMD "0020008008" "241234FFFFFFFFFF"
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT

// 1st Generate AC
SET CDOL1_DATA "00000000020000000000000001560000000000015618071109113900A8EBC593"
APPEND CMD "80AE800020" CDOL1_DATA
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT

LEFT TEMP RESP 2
JE TEMP "77" TRANSACTION7_1st_GENERATE_AC_TAG_77
MID ATC RESP 7 4
MID RESP_AC1 RESP 11 16
MID CVR RESP 33 8

JMP TRANSACTION7_1st_GENERATE_AC_TAG_77_END
TRANSACTION7_1st_GENERATE_AC_TAG_77:
FINDTLV ATC "9F36" RESP
FINDTLV RESP_AC1 "9F36" RESP
FINDTLV IAD "9F36" RESP
TRANSACTION7_1st_GENERATE_AC_TAG_77_END:

NOT TEMP ATC
APPEND DATA "000000000000" ATC "000000000000" TEMP
CIPHER SESK DATA UDK TDES_ENC_ECB

APPEND TEMP "000000000200000000000000015600000000000156180711" "00A8EBC593"
APPEND DATA TEMP AIP ATC CVR
PADDING DATA DATA PAD_ISO9797_M2
CIPHER CAC DATA SESK DES_TDES_MAC
COMPARE CAC RESP_AC1 0

// 2nd Generate AC
SET CDOL2_DATA "303000000000020000000000000001560000000000015618071109113900A8EBC593"
APPEND CMD "80AE400022" CDOL2_DATA
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT

LEFT TEMP RESP 2
JE TEMP "77" TRANSACTION7_2nd_GENERATE_AC_TAG_77
MID ATC RESP 7 4
MID RESP_AC2 RESP 11 16
MID CVR RESP 33 8

JMP TRANSACTION7_2nd_GENERATE_AC_TAG_77_END
TRANSACTION7_2nd_GENERATE_AC_TAG_77:
FINDTLV ATC "9F36" RESP
FINDTLV RESP_AC2 "9F36" RESP
FINDTLV IAD "9F36" RESP
TRANSACTION7_2nd_GENERATE_AC_TAG_77_END:

APPEND TEMP "000000000200000000000000015600000000000156180711" "00A8EBC593"
APPEND DATA TEMP AIP ATC CVR
PADDING DATA DATA PAD_ISO9797_M2
CIPHER CAC DATA SESK DES_TDES_MAC
COMPARE CAC RESP_AC2 0

// Get Data
SET CMD "80CA9F5600"
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT
FINDTLV RESP "9F56" RESP

// Get Data
SET CMD "80CA9F7700"
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT
FINDTLV RESP "9F77" RESP

// Get Data
SET CMD "80CA9F7800"
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT
FINDTLV RESP "9F78" RESP

// Get Data
SET CMD "80CA9F7900"
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT
FINDTLV RESP "9F79" RESP
// ERROR!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
// comment :  <p style="color:FF0000">Error:��Ƭ����9F79ֵӦΪ000000014800</p>
COMPARE "00" "FF" 0
// ERROR!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!

// Get Data
SET CMD "80CA9F6B00"
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT
FINDTLV RESP "9F6B" RESP

// Get Data
SET CMD "80CA9F6D00"
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT
FINDTLV RESP "9F6D" RESP

// =======================================transaction 8=======================================
// RESET
POWERON USERCARD RESP
SET P2 0

// SELECT PPSE
SET AID "325041592E5359532E4444463031"
GPSELECT USERCARD AID RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT

// SELECT PBOC
SET AID "A0000003330101"
GPSELECT USERCARD AID RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT

// GPO
SET PDOL_DATA "831026000080000000000200A8EBC5EB0156"
APPEND CMD "80A8000012" PDOL_DATA
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT

LEFT TEMP RESP 2
JE TEMP "77" TRANSACTION8_GPO_RESPONSE_TAG_77
MID AIP RESP 5 4
MID AFL RESP 9
JMP TRANSACTION8_GPO_RESPONSE_TAG_77_END
TRANSACTION8_GPO_RESPONSE_TAG_77:

FINDTLV AIP "82" RESP
FINDTLV AFL "94" RESP
FINDTLV ATC "9F36" RESP
FINDTLV IAD "9F10" RESP
MID CVR IAD 7 8
TRANSACTION8_GPO_RESPONSE_TAG_77_END:

// Read Record
SET CMD "00B2011C00"
SENDAPDU USERCARD CMD RESP SW "9000"

// Read Record
SET CMD "00B2050C00"
SENDAPDU USERCARD CMD RESP SW "9000"

// Read Record
SET CMD "00B2031400"
SENDAPDU USERCARD CMD RESP SW "9000"

// Read Record
SET CMD "00B2041400"
SENDAPDU USERCARD CMD RESP SW "9000"

// Read Record
SET CMD "00B2051400"
SENDAPDU USERCARD CMD RESP SW "9000"

// Read Record
SET CMD "00B2061400"
SENDAPDU USERCARD CMD RESP SW "9000"

// Read Record
SET CMD "00B2071400"
SENDAPDU USERCARD CMD RESP SW "9000"

// Read Record
SET CMD "00B2012400"
SENDAPDU USERCARD CMD RESP SW "9000"

// Read Record
SET CMD "00B2032C00"
SENDAPDU USERCARD CMD RESP SW "9000"

// Get Data
SET CMD "80CA9F7700"
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT
FINDTLV RESP "9F77" RESP

// Get Data
SET CMD "80CA9F7800"
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT
FINDTLV RESP "9F78" RESP

// Get Data
SET CMD "80CA9F7900"
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT
FINDTLV RESP "9F79" RESP
// ERROR!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
// comment :  <p style="color:FF0000">Error:��Ƭ����9F79ֵӦΪ000000014600</p>
COMPARE "00" "FF" 0
// ERROR!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!

// Get Data
SET CMD "80CA9F6B00"
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT
FINDTLV RESP "9F6B" RESP

// Get Data
SET CMD "80CA9F6D00"
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT
FINDTLV RESP "9F6D" RESP

// Get Data
SET CMD "80CA9F5D00"
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT
FINDTLV RESP "9F5D" RESP

// =======================================transaction 9=======================================
// RESET
POWERON USERCARD RESP
SET P2 0

// SELECT PPSE
SET AID "325041592E5359532E4444463031"
GPSELECT USERCARD AID RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT

// SELECT PBOC
SET AID "A0000003330101"
GPSELECT USERCARD AID RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT

// GPO
SET PDOL_DATA "831026000080000000000400A8EBC5E80344"
APPEND CMD "80A8000012" PDOL_DATA
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT

LEFT TEMP RESP 2
JE TEMP "77" TRANSACTION9_GPO_RESPONSE_TAG_77
MID AIP RESP 5 4
MID AFL RESP 9
JMP TRANSACTION9_GPO_RESPONSE_TAG_77_END
TRANSACTION9_GPO_RESPONSE_TAG_77:

FINDTLV AIP "82" RESP
FINDTLV AFL "94" RESP
FINDTLV ATC "9F36" RESP
FINDTLV IAD "9F10" RESP
MID CVR IAD 7 8
TRANSACTION9_GPO_RESPONSE_TAG_77_END:

// Read Record
SET CMD "00B2011C00"
SENDAPDU USERCARD CMD RESP SW "9000"

// Read Record
SET CMD "00B2050C00"
SENDAPDU USERCARD CMD RESP SW "9000"

// Read Record
SET CMD "00B2031400"
SENDAPDU USERCARD CMD RESP SW "9000"

// Read Record
SET CMD "00B2041400"
SENDAPDU USERCARD CMD RESP SW "9000"

// Read Record
SET CMD "00B2051400"
SENDAPDU USERCARD CMD RESP SW "9000"

// Read Record
SET CMD "00B2061400"
SENDAPDU USERCARD CMD RESP SW "9000"

// Read Record
SET CMD "00B2071400"
SENDAPDU USERCARD CMD RESP SW "9000"

// Read Record
SET CMD "00B2012400"
SENDAPDU USERCARD CMD RESP SW "9000"

// Read Record
SET CMD "00B2032C00"
SENDAPDU USERCARD CMD RESP SW "9000"

// =======================================transaction 10=======================================
// RESET
POWERON USERCARD RESP
SET P2 0

// SELECT PPSE
SET AID "325041592E5359532E4444463031"
GPSELECT USERCARD AID RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT

// SELECT PBOC
SET AID "A0000003330101"
GPSELECT USERCARD AID RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT

// Get Data
SET CMD "80CA9F7700"
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT
FINDTLV RESP "9F77" RESP

// Get Data
SET CMD "80CA9F7800"
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT
FINDTLV RESP "9F78" RESP

// Get Data
SET CMD "80CA9F7900"
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT
FINDTLV RESP "9F79" RESP
// ERROR!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
// comment :  <p style="color:FF0000">Error:��Ƭ����9F79ֵӦΪ000000014600</p>
COMPARE "00" "FF" 0
// ERROR!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!

// Get Data
SET CMD "80CA9F6B00"
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT
FINDTLV RESP "9F6B" RESP

// Get Data
SET CMD "80CA9F6D00"
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT
FINDTLV RESP "9F6D" RESP

// Get Data
SET CMD "80CA9F5D00"
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT
FINDTLV RESP "9F5D" RESP

// GPO
SET PDOL_DATA "8310F6000000000000000400A8EBC5E90344"
APPEND CMD "80A8000012" PDOL_DATA
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT

LEFT TEMP RESP 2
JE TEMP "77" TRANSACTION10_GPO_RESPONSE_TAG_77
MID AIP RESP 5 4
MID AFL RESP 9
JMP TRANSACTION10_GPO_RESPONSE_TAG_77_END
TRANSACTION10_GPO_RESPONSE_TAG_77:

FINDTLV AIP "82" RESP
FINDTLV AFL "94" RESP
FINDTLV ATC "9F36" RESP
FINDTLV IAD "9F10" RESP
MID CVR IAD 7 8
TRANSACTION10_GPO_RESPONSE_TAG_77_END:

// Read Record
SET CMD "00B2010C00"
SENDAPDU USERCARD CMD RESP SW "9000"

// Read Record
SET CMD "00B2020C00"
SENDAPDU USERCARD CMD RESP SW "9000"

// Read Record
SET CMD "00B2050C00"
SENDAPDU USERCARD CMD RESP SW "9000"

// Read Record
SET CMD "00B2031400"
SENDAPDU USERCARD CMD RESP SW "9000"

// Read Record
SET CMD "00B2041400"
SENDAPDU USERCARD CMD RESP SW "9000"

// Read Record
SET CMD "00B2051400"
SENDAPDU USERCARD CMD RESP SW "9000"

// Read Record
SET CMD "00B2061400"
SENDAPDU USERCARD CMD RESP SW "9000"

// Read Record
SET CMD "00B2071400"
SENDAPDU USERCARD CMD RESP SW "9000"

// Read Record
SET CMD "00B2012400"
SENDAPDU USERCARD CMD RESP SW "9000"

// Get Data
SET CMD "80CA9F1700"
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT
FINDTLV RESP "9F17" RESP

// Verify Pin
APPEND CMD "0020008008" "241234FFFFFFFFFF"
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT

// 1st Generate AC
SET CDOL1_DATA "00000000040000000000000001560000000000034418071109114300A8EBC5E9"
APPEND CMD "80AE800020" CDOL1_DATA
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT

LEFT TEMP RESP 2
JE TEMP "77" TRANSACTION10_1st_GENERATE_AC_TAG_77
MID ATC RESP 7 4
MID RESP_AC1 RESP 11 16
MID CVR RESP 33 8

JMP TRANSACTION10_1st_GENERATE_AC_TAG_77_END
TRANSACTION10_1st_GENERATE_AC_TAG_77:
FINDTLV ATC "9F36" RESP
FINDTLV RESP_AC1 "9F36" RESP
FINDTLV IAD "9F36" RESP
TRANSACTION10_1st_GENERATE_AC_TAG_77_END:

NOT TEMP ATC
APPEND DATA "000000000000" ATC "000000000000" TEMP
CIPHER SESK DATA UDK TDES_ENC_ECB

APPEND TEMP "000000000400000000000000015600000000000344180711" "00A8EBC5E9"
APPEND DATA TEMP AIP ATC CVR
PADDING DATA DATA PAD_ISO9797_M2
CIPHER CAC DATA SESK DES_TDES_MAC
COMPARE CAC RESP_AC1 0

// 2nd Generate AC
SET CDOL2_DATA "303000000000040000000000000001560000000000034418071109114300A8EBC5E9"
APPEND CMD "80AE400022" CDOL2_DATA
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT

LEFT TEMP RESP 2
JE TEMP "77" TRANSACTION10_2nd_GENERATE_AC_TAG_77
MID ATC RESP 7 4
MID RESP_AC2 RESP 11 16
MID CVR RESP 33 8

JMP TRANSACTION10_2nd_GENERATE_AC_TAG_77_END
TRANSACTION10_2nd_GENERATE_AC_TAG_77:
FINDTLV ATC "9F36" RESP
FINDTLV RESP_AC2 "9F36" RESP
FINDTLV IAD "9F36" RESP
TRANSACTION10_2nd_GENERATE_AC_TAG_77_END:

APPEND TEMP "000000000400000000000000015600000000000344180711" "00A8EBC5E9"
APPEND DATA TEMP AIP ATC CVR
PADDING DATA DATA PAD_ISO9797_M2
CIPHER CAC DATA SESK DES_TDES_MAC
COMPARE CAC RESP_AC2 0

// Get Data
SET CMD "80CA9F5600"
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT
FINDTLV RESP "9F56" RESP

// Get Data
SET CMD "80CA9F7700"
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT
FINDTLV RESP "9F77" RESP

// Get Data
SET CMD "80CA9F7800"
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT
FINDTLV RESP "9F78" RESP

// Get Data
SET CMD "80CA9F7900"
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT
FINDTLV RESP "9F79" RESP
// ERROR!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
// comment :  <p style="color:FF0000">Error:��Ƭ����9F79ֵӦΪ000000019600</p>
COMPARE "00" "FF" 0
// ERROR!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!

// Get Data
SET CMD "80CA9F6B00"
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT
FINDTLV RESP "9F6B" RESP

// Get Data
SET CMD "80CA9F6D00"
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT
FINDTLV RESP "9F6D" RESP

// =======================================transaction 11=======================================
// RESET
POWERON USERCARD RESP
SET P2 0

// SELECT PPSE
SET AID "325041592E5359532E4444463031"
GPSELECT USERCARD AID RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT

// SELECT PBOC
SET AID "A0000003330101"
GPSELECT USERCARD AID RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT

// GPO
SET PDOL_DATA "831026000080000000000400A8EBC5EE0344"
APPEND CMD "80A8000012" PDOL_DATA
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT

LEFT TEMP RESP 2
JE TEMP "77" TRANSACTION11_GPO_RESPONSE_TAG_77
MID AIP RESP 5 4
MID AFL RESP 9
JMP TRANSACTION11_GPO_RESPONSE_TAG_77_END
TRANSACTION11_GPO_RESPONSE_TAG_77:

FINDTLV AIP "82" RESP
FINDTLV AFL "94" RESP
FINDTLV ATC "9F36" RESP
FINDTLV IAD "9F10" RESP
MID CVR IAD 7 8
TRANSACTION11_GPO_RESPONSE_TAG_77_END:

// Read Record
SET CMD "00B2011C00"
SENDAPDU USERCARD CMD RESP SW "9000"

// Read Record
SET CMD "00B2050C00"
SENDAPDU USERCARD CMD RESP SW "9000"

// Read Record
SET CMD "00B2031400"
SENDAPDU USERCARD CMD RESP SW "9000"

// Read Record
SET CMD "00B2041400"
SENDAPDU USERCARD CMD RESP SW "9000"

// Read Record
SET CMD "00B2051400"
SENDAPDU USERCARD CMD RESP SW "9000"

// Read Record
SET CMD "00B2061400"
SENDAPDU USERCARD CMD RESP SW "9000"

// Read Record
SET CMD "00B2071400"
SENDAPDU USERCARD CMD RESP SW "9000"

// Read Record
SET CMD "00B2012400"
SENDAPDU USERCARD CMD RESP SW "9000"

// Read Record
SET CMD "00B2032C00"
SENDAPDU USERCARD CMD RESP SW "9000"

// Get Data
SET CMD "80CA9F7700"
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT
FINDTLV RESP "9F77" RESP

// Get Data
SET CMD "80CA9F7800"
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT
FINDTLV RESP "9F78" RESP

// Get Data
SET CMD "80CA9F7900"
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT
FINDTLV RESP "9F79" RESP
// ERROR!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
// comment :  <p style="color:FF0000">Error:��Ƭ����9F79ֵӦΪ000000019200</p>
COMPARE "00" "FF" 0
// ERROR!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!

// Get Data
SET CMD "80CA9F6B00"
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT
FINDTLV RESP "9F6B" RESP

// Get Data
SET CMD "80CA9F6D00"
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT
FINDTLV RESP "9F6D" RESP

// Get Data
SET CMD "80CA9F5D00"
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT
FINDTLV RESP "9F5D" RESP

// =======================================transaction 12=======================================
// RESET
POWERON USERCARD RESP
SET P2 0

// SELECT PPSE
SET AID "325041592E5359532E4444463031"
GPSELECT USERCARD AID RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT

// SELECT PBOC
SET AID "A0000003330101"
GPSELECT USERCARD AID RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT

// GPO
SET PDOL_DATA "831026000080000000000200A8EBC5EC0156"
APPEND CMD "80A8000012" PDOL_DATA
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT

LEFT TEMP RESP 2
JE TEMP "77" TRANSACTION12_GPO_RESPONSE_TAG_77
MID AIP RESP 5 4
MID AFL RESP 9
JMP TRANSACTION12_GPO_RESPONSE_TAG_77_END
TRANSACTION12_GPO_RESPONSE_TAG_77:

FINDTLV AIP "82" RESP
FINDTLV AFL "94" RESP
FINDTLV ATC "9F36" RESP
FINDTLV IAD "9F10" RESP
MID CVR IAD 7 8
TRANSACTION12_GPO_RESPONSE_TAG_77_END:

// Read Record
SET CMD "00B2011C00"
SENDAPDU USERCARD CMD RESP SW "9000"

// Read Record
SET CMD "00B2050C00"
SENDAPDU USERCARD CMD RESP SW "9000"

// Read Record
SET CMD "00B2031400"
SENDAPDU USERCARD CMD RESP SW "9000"

// Read Record
SET CMD "00B2041400"
SENDAPDU USERCARD CMD RESP SW "9000"

// Read Record
SET CMD "00B2051400"
SENDAPDU USERCARD CMD RESP SW "9000"

// Read Record
SET CMD "00B2061400"
SENDAPDU USERCARD CMD RESP SW "9000"

// Read Record
SET CMD "00B2071400"
SENDAPDU USERCARD CMD RESP SW "9000"

// Read Record
SET CMD "00B2012400"
SENDAPDU USERCARD CMD RESP SW "9000"

// Read Record
SET CMD "00B2032C00"
SENDAPDU USERCARD CMD RESP SW "9000"

// =======================================transaction 13=======================================
// RESET
POWERON USERCARD RESP
SET P2 0

// SELECT PPSE
SET AID "325041592E5359532E4444463031"
GPSELECT USERCARD AID RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT

// SELECT PBOC
SET AID "A0000003330101"
GPSELECT USERCARD AID RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT

// Get Data
SET CMD "80CA9F7700"
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT
FINDTLV RESP "9F77" RESP

// Get Data
SET CMD "80CA9F7800"
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT
FINDTLV RESP "9F78" RESP

// Get Data
SET CMD "80CA9F7900"
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT
FINDTLV RESP "9F79" RESP
// ERROR!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
// comment :  <p style="color:FF0000">Error:��Ƭ����9F79ֵӦΪ000000014400</p>
COMPARE "00" "FF" 0
// ERROR!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!

// Get Data
SET CMD "80CA9F6B00"
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT
FINDTLV RESP "9F6B" RESP

// Get Data
SET CMD "80CA9F6D00"
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT
FINDTLV RESP "9F6D" RESP

// Get Data
SET CMD "80CA9F5D00"
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT
FINDTLV RESP "9F5D" RESP

// GPO
SET PDOL_DATA "8310F6000000000000000200A8EBC5ED0840"
APPEND CMD "80A8000012" PDOL_DATA
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT

LEFT TEMP RESP 2
JE TEMP "77" TRANSACTION13_GPO_RESPONSE_TAG_77
MID AIP RESP 5 4
MID AFL RESP 9
JMP TRANSACTION13_GPO_RESPONSE_TAG_77_END
TRANSACTION13_GPO_RESPONSE_TAG_77:

FINDTLV AIP "82" RESP
FINDTLV AFL "94" RESP
FINDTLV ATC "9F36" RESP
FINDTLV IAD "9F10" RESP
MID CVR IAD 7 8
TRANSACTION13_GPO_RESPONSE_TAG_77_END:

// Read Record
SET CMD "00B2010C00"
SENDAPDU USERCARD CMD RESP SW "9000"

// Read Record
SET CMD "00B2020C00"
SENDAPDU USERCARD CMD RESP SW "9000"

// Read Record
SET CMD "00B2050C00"
SENDAPDU USERCARD CMD RESP SW "9000"

// Read Record
SET CMD "00B2031400"
SENDAPDU USERCARD CMD RESP SW "9000"

// Read Record
SET CMD "00B2041400"
SENDAPDU USERCARD CMD RESP SW "9000"

// Read Record
SET CMD "00B2051400"
SENDAPDU USERCARD CMD RESP SW "9000"

// Read Record
SET CMD "00B2061400"
SENDAPDU USERCARD CMD RESP SW "9000"

// Read Record
SET CMD "00B2071400"
SENDAPDU USERCARD CMD RESP SW "9000"

// Read Record
SET CMD "00B2012400"
SENDAPDU USERCARD CMD RESP SW "9000"

// Get Data
SET CMD "80CA9F1700"
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT
FINDTLV RESP "9F17" RESP

// Verify Pin
APPEND CMD "0020008008" "241234FFFFFFFFFF"
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT

// 1st Generate AC
SET CDOL1_DATA "00000000020000000000000001560000000000084018071109114700A8EBC5ED"
APPEND CMD "80AE800020" CDOL1_DATA
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT

LEFT TEMP RESP 2
JE TEMP "77" TRANSACTION13_1st_GENERATE_AC_TAG_77
MID ATC RESP 7 4
MID RESP_AC1 RESP 11 16
MID CVR RESP 33 8

JMP TRANSACTION13_1st_GENERATE_AC_TAG_77_END
TRANSACTION13_1st_GENERATE_AC_TAG_77:
FINDTLV ATC "9F36" RESP
FINDTLV RESP_AC1 "9F36" RESP
FINDTLV IAD "9F36" RESP
TRANSACTION13_1st_GENERATE_AC_TAG_77_END:

NOT TEMP ATC
APPEND DATA "000000000000" ATC "000000000000" TEMP
CIPHER SESK DATA UDK TDES_ENC_ECB

APPEND TEMP "000000000200000000000000015600000000000840180711" "00A8EBC5ED"
APPEND DATA TEMP AIP ATC CVR
PADDING DATA DATA PAD_ISO9797_M2
CIPHER CAC DATA SESK DES_TDES_MAC
COMPARE CAC RESP_AC1 0

// 2nd Generate AC
SET CDOL2_DATA "303000000000020000000000000001560000000000084018071109114700A8EBC5ED"
APPEND CMD "80AE400022" CDOL2_DATA
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT

LEFT TEMP RESP 2
JE TEMP "77" TRANSACTION13_2nd_GENERATE_AC_TAG_77
MID ATC RESP 7 4
MID RESP_AC2 RESP 11 16
MID CVR RESP 33 8

JMP TRANSACTION13_2nd_GENERATE_AC_TAG_77_END
TRANSACTION13_2nd_GENERATE_AC_TAG_77:
FINDTLV ATC "9F36" RESP
FINDTLV RESP_AC2 "9F36" RESP
FINDTLV IAD "9F36" RESP
TRANSACTION13_2nd_GENERATE_AC_TAG_77_END:

APPEND TEMP "000000000200000000000000015600000000000840180711" "00A8EBC5ED"
APPEND DATA TEMP AIP ATC CVR
PADDING DATA DATA PAD_ISO9797_M2
CIPHER CAC DATA SESK DES_TDES_MAC
COMPARE CAC RESP_AC2 0

// Get Data
SET CMD "80CA9F5600"
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT
FINDTLV RESP "9F56" RESP

// Get Data
SET CMD "80CA9F7700"
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT
FINDTLV RESP "9F77" RESP

// Get Data
SET CMD "80CA9F7800"
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT
FINDTLV RESP "9F78" RESP

// Get Data
SET CMD "80CA9F7900"
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT
FINDTLV RESP "9F79" RESP
// ERROR!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
// comment :  <p style="color:FF0000">Error:��Ƭ����9F79ֵӦΪ000000014400</p>
COMPARE "00" "FF" 0
// ERROR!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!

// Get Data
SET CMD "80CA9F6B00"
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT
FINDTLV RESP "9F6B" RESP

// Get Data
SET CMD "80CA9F6D00"
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT
FINDTLV RESP "9F6D" RESP

// =======================================transaction 14=======================================
// RESET
POWERON USERCARD RESP
SET P2 0

// SELECT PPSE
SET AID "325041592E5359532E4444463031"
GPSELECT USERCARD AID RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT

// SELECT PBOC
SET AID "A0000003330101"
GPSELECT USERCARD AID RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT

// GPO
SET PDOL_DATA "831026000080000000000200A8EBC5E20156"
APPEND CMD "80A8000012" PDOL_DATA
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT

LEFT TEMP RESP 2
JE TEMP "77" TRANSACTION14_GPO_RESPONSE_TAG_77
MID AIP RESP 5 4
MID AFL RESP 9
JMP TRANSACTION14_GPO_RESPONSE_TAG_77_END
TRANSACTION14_GPO_RESPONSE_TAG_77:

FINDTLV AIP "82" RESP
FINDTLV AFL "94" RESP
FINDTLV ATC "9F36" RESP
FINDTLV IAD "9F10" RESP
MID CVR IAD 7 8
TRANSACTION14_GPO_RESPONSE_TAG_77_END:

// Read Record
SET CMD "00B2011C00"
SENDAPDU USERCARD CMD RESP SW "9000"

// Read Record
SET CMD "00B2050C00"
SENDAPDU USERCARD CMD RESP SW "9000"

// Read Record
SET CMD "00B2031400"
SENDAPDU USERCARD CMD RESP SW "9000"

// Read Record
SET CMD "00B2041400"
SENDAPDU USERCARD CMD RESP SW "9000"

// Read Record
SET CMD "00B2051400"
SENDAPDU USERCARD CMD RESP SW "9000"

// Read Record
SET CMD "00B2061400"
SENDAPDU USERCARD CMD RESP SW "9000"

// Read Record
SET CMD "00B2071400"
SENDAPDU USERCARD CMD RESP SW "9000"

// Read Record
SET CMD "00B2012400"
SENDAPDU USERCARD CMD RESP SW "9000"

// Read Record
SET CMD "00B2032C00"
SENDAPDU USERCARD CMD RESP SW "9000"

// Get Data
SET CMD "80CA9F7700"
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT
FINDTLV RESP "9F77" RESP

// Get Data
SET CMD "80CA9F7800"
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT
FINDTLV RESP "9F78" RESP

// Get Data
SET CMD "80CA9F7900"
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT
FINDTLV RESP "9F79" RESP
// ERROR!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
// comment :  <p style="color:FF0000">Error:��Ƭ����9F79ֵӦΪ000000014200</p>
COMPARE "00" "FF" 0
// ERROR!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!

// Get Data
SET CMD "80CA9F6B00"
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT
FINDTLV RESP "9F6B" RESP

// Get Data
SET CMD "80CA9F6D00"
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT
FINDTLV RESP "9F6D" RESP

// Get Data
SET CMD "80CA9F5D00"
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT
FINDTLV RESP "9F5D" RESP

// =======================================transaction 15=======================================
// RESET
POWERON USERCARD RESP
SET P2 0

// SELECT PPSE
SET AID "325041592E5359532E4444463031"
GPSELECT USERCARD AID RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT

// SELECT PBOC
SET AID "A0000003330101"
GPSELECT USERCARD AID RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT

// Get Data
SET CMD "80CA9F7700"
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT
FINDTLV RESP "9F77" RESP

// Get Data
SET CMD "80CA9F7800"
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT
FINDTLV RESP "9F78" RESP

// Get Data
SET CMD "80CA9F7900"
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT
FINDTLV RESP "9F79" RESP
// ERROR!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
// comment :  <p style="color:FF0000">Error:��Ƭ����9F79ֵӦΪ000000014200</p>
COMPARE "00" "FF" 0
// ERROR!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!

// Get Data
SET CMD "80CA9F6B00"
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT
FINDTLV RESP "9F6B" RESP

// Get Data
SET CMD "80CA9F6D00"
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT
FINDTLV RESP "9F6D" RESP

// Get Data
SET CMD "80CA9F5D00"
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT
FINDTLV RESP "9F5D" RESP

// GPO
SET PDOL_DATA "8310F6000000000000000200A8EBC5FA0156"
APPEND CMD "80A8000012" PDOL_DATA
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT

LEFT TEMP RESP 2
JE TEMP "77" TRANSACTION15_GPO_RESPONSE_TAG_77
MID AIP RESP 5 4
MID AFL RESP 9
JMP TRANSACTION15_GPO_RESPONSE_TAG_77_END
TRANSACTION15_GPO_RESPONSE_TAG_77:

FINDTLV AIP "82" RESP
FINDTLV AFL "94" RESP
FINDTLV ATC "9F36" RESP
FINDTLV IAD "9F10" RESP
MID CVR IAD 7 8
TRANSACTION15_GPO_RESPONSE_TAG_77_END:

// Read Record
SET CMD "00B2010C00"
SENDAPDU USERCARD CMD RESP SW "9000"

// Read Record
SET CMD "00B2020C00"
SENDAPDU USERCARD CMD RESP SW "9000"

// Read Record
SET CMD "00B2050C00"
SENDAPDU USERCARD CMD RESP SW "9000"

// Read Record
SET CMD "00B2031400"
SENDAPDU USERCARD CMD RESP SW "9000"

// Read Record
SET CMD "00B2041400"
SENDAPDU USERCARD CMD RESP SW "9000"

// Read Record
SET CMD "00B2051400"
SENDAPDU USERCARD CMD RESP SW "9000"

// Read Record
SET CMD "00B2061400"
SENDAPDU USERCARD CMD RESP SW "9000"

// Read Record
SET CMD "00B2071400"
SENDAPDU USERCARD CMD RESP SW "9000"

// Read Record
SET CMD "00B2012400"
SENDAPDU USERCARD CMD RESP SW "9000"

// Get Data
SET CMD "80CA9F1700"
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT
FINDTLV RESP "9F17" RESP

// Verify Pin
APPEND CMD "0020008008" "241234FFFFFFFFFF"
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT

// 1st Generate AC
SET CDOL1_DATA "00000000020000000000000001560000000000015618071109115000A8EBC5FA"
APPEND CMD "80AE800020" CDOL1_DATA
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT

LEFT TEMP RESP 2
JE TEMP "77" TRANSACTION15_1st_GENERATE_AC_TAG_77
MID ATC RESP 7 4
MID RESP_AC1 RESP 11 16
MID CVR RESP 33 8

JMP TRANSACTION15_1st_GENERATE_AC_TAG_77_END
TRANSACTION15_1st_GENERATE_AC_TAG_77:
FINDTLV ATC "9F36" RESP
FINDTLV RESP_AC1 "9F36" RESP
FINDTLV IAD "9F36" RESP
TRANSACTION15_1st_GENERATE_AC_TAG_77_END:

NOT TEMP ATC
APPEND DATA "000000000000" ATC "000000000000" TEMP
CIPHER SESK DATA UDK TDES_ENC_ECB

APPEND TEMP "000000000200000000000000015600000000000156180711" "00A8EBC5FA"
APPEND DATA TEMP AIP ATC CVR
PADDING DATA DATA PAD_ISO9797_M2
CIPHER CAC DATA SESK DES_TDES_MAC
COMPARE CAC RESP_AC1 0

// External Authenticate
NOT TEMP ATC
APPEND DATA "000000000000" ATC "000000000000" TEMP
CIPHER SESK DATA UDK TDES_ENC_ECB
APPEND DATA "3030" "000000000000"
XOR DATA CAC DATA
APPEND DATA DATA "0000000000000000"
CIPHER ARQC DATA SESK TDES_ENC_ECB
LEFT ARQC ARQC 16
APPEND CMD "008200000A" ARQC "3030"
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT

// 2nd Generate AC
SET CDOL2_DATA "303000000000020000000000000001560000000000015618071109115000A8EBC5FA"
APPEND CMD "80AE400022" CDOL2_DATA
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT

LEFT TEMP RESP 2
JE TEMP "77" TRANSACTION15_2nd_GENERATE_AC_TAG_77
MID ATC RESP 7 4
MID RESP_AC2 RESP 11 16
MID CVR RESP 33 8

JMP TRANSACTION15_2nd_GENERATE_AC_TAG_77_END
TRANSACTION15_2nd_GENERATE_AC_TAG_77:
FINDTLV ATC "9F36" RESP
FINDTLV RESP_AC2 "9F36" RESP
FINDTLV IAD "9F36" RESP
TRANSACTION15_2nd_GENERATE_AC_TAG_77_END:

APPEND TEMP "000000000200000000000000015600000000000156180711" "00A8EBC5FA"
APPEND DATA TEMP AIP ATC CVR
PADDING DATA DATA PAD_ISO9797_M2
CIPHER CAC DATA SESK DES_TDES_MAC
COMPARE CAC RESP_AC2 0

// Make Session Key
NOT TEMP ATC
APPEND DATA "000000000000" ATC "000000000000" TEMP
CIPHER SESK DATA MDK TDES_ENC_ECB
// Put Data
SET CMD "04DADF6105"
APPEND DATA CMD ATC RESP_AC1 "00"
PADDING DATA DATA PAD_ISO9797_M2
CIPHER MAC DATA SESK DES_TDES_MAC
LEFT MAC MAC 8
APPEND CMD CMD "00" MAC
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT

// Get Data
SET CMD "80CADF6100"
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT
FINDTLV RESP "DF61" RESP

// Get Data
SET CMD "80CA9F7700"
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT
FINDTLV RESP "9F77" RESP

// Get Data
SET CMD "80CA9F7800"
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT
FINDTLV RESP "9F78" RESP

// Get Data
SET CMD "80CA9F7900"
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT
FINDTLV RESP "9F79" RESP

// Get Data
SET CMD "80CA9F6B00"
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT
FINDTLV RESP "9F6B" RESP

// Get Data
SET CMD "80CA9F6D00"
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT
FINDTLV RESP "9F6D" RESP

// Get Data
SET CMD "80CADF7700"
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT
FINDTLV RESP "DF77" RESP

// Get Data
SET CMD "80CADF7800"
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT
FINDTLV RESP "DF78" RESP

// Get Data
SET CMD "80CADF7900"
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT
FINDTLV RESP "DF79" RESP

// Get Data
SET CMD "80CADF7200"
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT
FINDTLV RESP "DF72" RESP

// Get Data
SET CMD "80CADF7600"
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT
FINDTLV RESP "DF76" RESP

// =======================================transaction 16=======================================
// RESET
POWERON USERCARD RESP
SET P2 0

// SELECT PPSE
SET AID "325041592E5359532E4444463031"
GPSELECT USERCARD AID RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT

// SELECT PBOC
SET AID "A0000003330101"
GPSELECT USERCARD AID RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT

// GPO
SET PDOL_DATA "831026000080000000000200A8EBC5FB0156"
APPEND CMD "80A8000012" PDOL_DATA
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT

LEFT TEMP RESP 2
JE TEMP "77" TRANSACTION16_GPO_RESPONSE_TAG_77
MID AIP RESP 5 4
MID AFL RESP 9
JMP TRANSACTION16_GPO_RESPONSE_TAG_77_END
TRANSACTION16_GPO_RESPONSE_TAG_77:

FINDTLV AIP "82" RESP
FINDTLV AFL "94" RESP
FINDTLV ATC "9F36" RESP
FINDTLV IAD "9F10" RESP
MID CVR IAD 7 8
TRANSACTION16_GPO_RESPONSE_TAG_77_END:

// Read Record
SET CMD "00B2011C00"
SENDAPDU USERCARD CMD RESP SW "9000"

// Read Record
SET CMD "00B2050C00"
SENDAPDU USERCARD CMD RESP SW "9000"

// Read Record
SET CMD "00B2031400"
SENDAPDU USERCARD CMD RESP SW "9000"

// Read Record
SET CMD "00B2041400"
SENDAPDU USERCARD CMD RESP SW "9000"

// Read Record
SET CMD "00B2051400"
SENDAPDU USERCARD CMD RESP SW "9000"

// Read Record
SET CMD "00B2061400"
SENDAPDU USERCARD CMD RESP SW "9000"

// Read Record
SET CMD "00B2071400"
SENDAPDU USERCARD CMD RESP SW "9000"

// Read Record
SET CMD "00B2012400"
SENDAPDU USERCARD CMD RESP SW "9000"

// Read Record
SET CMD "00B2032C00"
SENDAPDU USERCARD CMD RESP SW "9000"

// =======================================transaction 17=======================================
// RESET
POWERON USERCARD RESP
SET P2 0

// SELECT PPSE
SET AID "325041592E5359532E4444463031"
GPSELECT USERCARD AID RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT

// SELECT PBOC
SET AID "A0000003330101"
GPSELECT USERCARD AID RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT

// Get Data
SET CMD "80CA9F7700"
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT
FINDTLV RESP "9F77" RESP

// Get Data
SET CMD "80CA9F7800"
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT
FINDTLV RESP "9F78" RESP

// Get Data
SET CMD "80CA9F7900"
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT
FINDTLV RESP "9F79" RESP

// Get Data
SET CMD "80CA9F6B00"
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT
FINDTLV RESP "9F6B" RESP

// Get Data
SET CMD "80CA9F6D00"
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT
FINDTLV RESP "9F6D" RESP

// Get Data
SET CMD "80CA9F5D00"
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT
FINDTLV RESP "9F5D" RESP

// GPO
SET PDOL_DATA "8310F6000000000000000200A8EBC5F80156"
APPEND CMD "80A8000012" PDOL_DATA
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT

LEFT TEMP RESP 2
JE TEMP "77" TRANSACTION17_GPO_RESPONSE_TAG_77
MID AIP RESP 5 4
MID AFL RESP 9
JMP TRANSACTION17_GPO_RESPONSE_TAG_77_END
TRANSACTION17_GPO_RESPONSE_TAG_77:

FINDTLV AIP "82" RESP
FINDTLV AFL "94" RESP
FINDTLV ATC "9F36" RESP
FINDTLV IAD "9F10" RESP
MID CVR IAD 7 8
TRANSACTION17_GPO_RESPONSE_TAG_77_END:

// Read Record
SET CMD "00B2010C00"
SENDAPDU USERCARD CMD RESP SW "9000"

// Read Record
SET CMD "00B2020C00"
SENDAPDU USERCARD CMD RESP SW "9000"

// Read Record
SET CMD "00B2050C00"
SENDAPDU USERCARD CMD RESP SW "9000"

// Read Record
SET CMD "00B2031400"
SENDAPDU USERCARD CMD RESP SW "9000"

// Read Record
SET CMD "00B2041400"
SENDAPDU USERCARD CMD RESP SW "9000"

// Read Record
SET CMD "00B2051400"
SENDAPDU USERCARD CMD RESP SW "9000"

// Read Record
SET CMD "00B2061400"
SENDAPDU USERCARD CMD RESP SW "9000"

// Read Record
SET CMD "00B2071400"
SENDAPDU USERCARD CMD RESP SW "9000"

// Read Record
SET CMD "00B2012400"
SENDAPDU USERCARD CMD RESP SW "9000"

// Get Data
SET CMD "80CA9F1700"
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT
FINDTLV RESP "9F17" RESP

// Verify Pin
APPEND CMD "0020008008" "241234FFFFFFFFFF"
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT

// 1st Generate AC
SET CDOL1_DATA "00000000020000000000000001560000000000015618071109115200A8EBC5F8"
APPEND CMD "80AE800020" CDOL1_DATA
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT

LEFT TEMP RESP 2
JE TEMP "77" TRANSACTION17_1st_GENERATE_AC_TAG_77
MID ATC RESP 7 4
MID RESP_AC1 RESP 11 16
MID CVR RESP 33 8

JMP TRANSACTION17_1st_GENERATE_AC_TAG_77_END
TRANSACTION17_1st_GENERATE_AC_TAG_77:
FINDTLV ATC "9F36" RESP
FINDTLV RESP_AC1 "9F36" RESP
FINDTLV IAD "9F36" RESP
TRANSACTION17_1st_GENERATE_AC_TAG_77_END:

NOT TEMP ATC
APPEND DATA "000000000000" ATC "000000000000" TEMP
CIPHER SESK DATA UDK TDES_ENC_ECB

APPEND TEMP "000000000200000000000000015600000000000156180711" "00A8EBC5F8"
APPEND DATA TEMP AIP ATC CVR
PADDING DATA DATA PAD_ISO9797_M2
CIPHER CAC DATA SESK DES_TDES_MAC
COMPARE CAC RESP_AC1 0

// 2nd Generate AC
SET CDOL2_DATA "303000000000020000000000000001560000000000015618071109115200A8EBC5F8"
APPEND CMD "80AE400022" CDOL2_DATA
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT

LEFT TEMP RESP 2
JE TEMP "77" TRANSACTION17_2nd_GENERATE_AC_TAG_77
MID ATC RESP 7 4
MID RESP_AC2 RESP 11 16
MID CVR RESP 33 8

JMP TRANSACTION17_2nd_GENERATE_AC_TAG_77_END
TRANSACTION17_2nd_GENERATE_AC_TAG_77:
FINDTLV ATC "9F36" RESP
FINDTLV RESP_AC2 "9F36" RESP
FINDTLV IAD "9F36" RESP
TRANSACTION17_2nd_GENERATE_AC_TAG_77_END:

APPEND TEMP "000000000200000000000000015600000000000156180711" "00A8EBC5F8"
APPEND DATA TEMP AIP ATC CVR
PADDING DATA DATA PAD_ISO9797_M2
CIPHER CAC DATA SESK DES_TDES_MAC
COMPARE CAC RESP_AC2 0

// Get Data
SET CMD "80CA9F5600"
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT
FINDTLV RESP "9F56" RESP

// Get Data
SET CMD "80CA9F7700"
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT
FINDTLV RESP "9F77" RESP

// Get Data
SET CMD "80CA9F7800"
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT
FINDTLV RESP "9F78" RESP

// Get Data
SET CMD "80CA9F7900"
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT
FINDTLV RESP "9F79" RESP

// Get Data
SET CMD "80CA9F6B00"
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT
FINDTLV RESP "9F6B" RESP

// Get Data
SET CMD "80CA9F6D00"
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT
FINDTLV RESP "9F6D" RESP

// =======================================transaction 18=======================================
// RESET
POWERON USERCARD RESP
SET P2 0

// SELECT PPSE
SET AID "325041592E5359532E4444463031"
GPSELECT USERCARD AID RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT

// SELECT PBOC
SET AID "A0000003330101"
GPSELECT USERCARD AID RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT

// GPO
SET PDOL_DATA "831026000080000000000200A8EBC5FE0156"
APPEND CMD "80A8000012" PDOL_DATA
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT

LEFT TEMP RESP 2
JE TEMP "77" TRANSACTION18_GPO_RESPONSE_TAG_77
MID AIP RESP 5 4
MID AFL RESP 9
JMP TRANSACTION18_GPO_RESPONSE_TAG_77_END
TRANSACTION18_GPO_RESPONSE_TAG_77:

FINDTLV AIP "82" RESP
FINDTLV AFL "94" RESP
FINDTLV ATC "9F36" RESP
FINDTLV IAD "9F10" RESP
MID CVR IAD 7 8
TRANSACTION18_GPO_RESPONSE_TAG_77_END:

// Read Record
SET CMD "00B2011C00"
SENDAPDU USERCARD CMD RESP SW "9000"

// Read Record
SET CMD "00B2050C00"
SENDAPDU USERCARD CMD RESP SW "9000"

// Read Record
SET CMD "00B2031400"
SENDAPDU USERCARD CMD RESP SW "9000"

// Read Record
SET CMD "00B2041400"
SENDAPDU USERCARD CMD RESP SW "9000"

// Read Record
SET CMD "00B2051400"
SENDAPDU USERCARD CMD RESP SW "9000"

// Read Record
SET CMD "00B2061400"
SENDAPDU USERCARD CMD RESP SW "9000"

// Read Record
SET CMD "00B2071400"
SENDAPDU USERCARD CMD RESP SW "9000"

// Read Record
SET CMD "00B2012400"
SENDAPDU USERCARD CMD RESP SW "9000"

// Read Record
SET CMD "00B2032C00"
SENDAPDU USERCARD CMD RESP SW "9000"

// Get Data
SET CMD "80CA9F7700"
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT
FINDTLV RESP "9F77" RESP

// Get Data
SET CMD "80CA9F7800"
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT
FINDTLV RESP "9F78" RESP

// Get Data
SET CMD "80CA9F7900"
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT
FINDTLV RESP "9F79" RESP

// Get Data
SET CMD "80CA9F6B00"
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT
FINDTLV RESP "9F6B" RESP

// Get Data
SET CMD "80CA9F6D00"
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT
FINDTLV RESP "9F6D" RESP

// Get Data
SET CMD "80CA9F5D00"
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT
FINDTLV RESP "9F5D" RESP

// =======================================transaction 19=======================================
// RESET
POWERON USERCARD RESP
SET P2 0

// SELECT PPSE
SET AID "325041592E5359532E4444463031"
GPSELECT USERCARD AID RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT

// SELECT PBOC
SET AID "A0000003330101"
GPSELECT USERCARD AID RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT

// GPO
SET PDOL_DATA "831026000080000000000400A8EBC5FF0344"
APPEND CMD "80A8000012" PDOL_DATA
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT

LEFT TEMP RESP 2
JE TEMP "77" TRANSACTION19_GPO_RESPONSE_TAG_77
MID AIP RESP 5 4
MID AFL RESP 9
JMP TRANSACTION19_GPO_RESPONSE_TAG_77_END
TRANSACTION19_GPO_RESPONSE_TAG_77:

FINDTLV AIP "82" RESP
FINDTLV AFL "94" RESP
FINDTLV ATC "9F36" RESP
FINDTLV IAD "9F10" RESP
MID CVR IAD 7 8
TRANSACTION19_GPO_RESPONSE_TAG_77_END:

// Read Record
SET CMD "00B2011C00"
SENDAPDU USERCARD CMD RESP SW "9000"

// Read Record
SET CMD "00B2050C00"
SENDAPDU USERCARD CMD RESP SW "9000"

// Read Record
SET CMD "00B2031400"
SENDAPDU USERCARD CMD RESP SW "9000"

// Read Record
SET CMD "00B2041400"
SENDAPDU USERCARD CMD RESP SW "9000"

// Read Record
SET CMD "00B2051400"
SENDAPDU USERCARD CMD RESP SW "9000"

// Read Record
SET CMD "00B2061400"
SENDAPDU USERCARD CMD RESP SW "9000"

// Read Record
SET CMD "00B2071400"
SENDAPDU USERCARD CMD RESP SW "9000"

// Read Record
SET CMD "00B2012400"
SENDAPDU USERCARD CMD RESP SW "9000"

// Read Record
SET CMD "00B2032C00"
SENDAPDU USERCARD CMD RESP SW "9000"

// =======================================transaction 20=======================================
// RESET
POWERON USERCARD RESP
SET P2 0

// SELECT PPSE
SET AID "325041592E5359532E4444463031"
GPSELECT USERCARD AID RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT

// SELECT PBOC
SET AID "A0000003330101"
GPSELECT USERCARD AID RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT

// Get Data
SET CMD "80CA9F7700"
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT
FINDTLV RESP "9F77" RESP

// Get Data
SET CMD "80CA9F7800"
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT
FINDTLV RESP "9F78" RESP

// Get Data
SET CMD "80CA9F7900"
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT
FINDTLV RESP "9F79" RESP

// Get Data
SET CMD "80CA9F6B00"
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT
FINDTLV RESP "9F6B" RESP

// Get Data
SET CMD "80CA9F6D00"
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT
FINDTLV RESP "9F6D" RESP

// Get Data
SET CMD "80CA9F5D00"
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT
FINDTLV RESP "9F5D" RESP

// GPO
SET PDOL_DATA "8310F6000000000000000400A8EBC5FC0344"
APPEND CMD "80A8000012" PDOL_DATA
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT

LEFT TEMP RESP 2
JE TEMP "77" TRANSACTION20_GPO_RESPONSE_TAG_77
MID AIP RESP 5 4
MID AFL RESP 9
JMP TRANSACTION20_GPO_RESPONSE_TAG_77_END
TRANSACTION20_GPO_RESPONSE_TAG_77:

FINDTLV AIP "82" RESP
FINDTLV AFL "94" RESP
FINDTLV ATC "9F36" RESP
FINDTLV IAD "9F10" RESP
MID CVR IAD 7 8
TRANSACTION20_GPO_RESPONSE_TAG_77_END:

// Read Record
SET CMD "00B2010C00"
SENDAPDU USERCARD CMD RESP SW "9000"

// Read Record
SET CMD "00B2020C00"
SENDAPDU USERCARD CMD RESP SW "9000"

// Read Record
SET CMD "00B2050C00"
SENDAPDU USERCARD CMD RESP SW "9000"

// Read Record
SET CMD "00B2031400"
SENDAPDU USERCARD CMD RESP SW "9000"

// Read Record
SET CMD "00B2041400"
SENDAPDU USERCARD CMD RESP SW "9000"

// Read Record
SET CMD "00B2051400"
SENDAPDU USERCARD CMD RESP SW "9000"

// Read Record
SET CMD "00B2061400"
SENDAPDU USERCARD CMD RESP SW "9000"

// Read Record
SET CMD "00B2071400"
SENDAPDU USERCARD CMD RESP SW "9000"

// Read Record
SET CMD "00B2012400"
SENDAPDU USERCARD CMD RESP SW "9000"

// Get Data
SET CMD "80CA9F1700"
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT
FINDTLV RESP "9F17" RESP

// Verify Pin
APPEND CMD "0020008008" "241234FFFFFFFFFF"
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT

// 1st Generate AC
SET CDOL1_DATA "00000000040000000000000001560000000000034418071109115600A8EBC5FC"
APPEND CMD "80AE800020" CDOL1_DATA
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT

LEFT TEMP RESP 2
JE TEMP "77" TRANSACTION20_1st_GENERATE_AC_TAG_77
MID ATC RESP 7 4
MID RESP_AC1 RESP 11 16
MID CVR RESP 33 8

JMP TRANSACTION20_1st_GENERATE_AC_TAG_77_END
TRANSACTION20_1st_GENERATE_AC_TAG_77:
FINDTLV ATC "9F36" RESP
FINDTLV RESP_AC1 "9F36" RESP
FINDTLV IAD "9F36" RESP
TRANSACTION20_1st_GENERATE_AC_TAG_77_END:

NOT TEMP ATC
APPEND DATA "000000000000" ATC "000000000000" TEMP
CIPHER SESK DATA UDK TDES_ENC_ECB

APPEND TEMP "000000000400000000000000015600000000000344180711" "00A8EBC5FC"
APPEND DATA TEMP AIP ATC CVR
PADDING DATA DATA PAD_ISO9797_M2
CIPHER CAC DATA SESK DES_TDES_MAC
COMPARE CAC RESP_AC1 0

// 2nd Generate AC
SET CDOL2_DATA "303000000000040000000000000001560000000000034418071109115600A8EBC5FC"
APPEND CMD "80AE400022" CDOL2_DATA
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT

LEFT TEMP RESP 2
JE TEMP "77" TRANSACTION20_2nd_GENERATE_AC_TAG_77
MID ATC RESP 7 4
MID RESP_AC2 RESP 11 16
MID CVR RESP 33 8

JMP TRANSACTION20_2nd_GENERATE_AC_TAG_77_END
TRANSACTION20_2nd_GENERATE_AC_TAG_77:
FINDTLV ATC "9F36" RESP
FINDTLV RESP_AC2 "9F36" RESP
FINDTLV IAD "9F36" RESP
TRANSACTION20_2nd_GENERATE_AC_TAG_77_END:

APPEND TEMP "000000000400000000000000015600000000000344180711" "00A8EBC5FC"
APPEND DATA TEMP AIP ATC CVR
PADDING DATA DATA PAD_ISO9797_M2
CIPHER CAC DATA SESK DES_TDES_MAC
COMPARE CAC RESP_AC2 0

// Get Data
SET CMD "80CA9F5600"
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT
FINDTLV RESP "9F56" RESP

// Get Data
SET CMD "80CA9F7700"
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT
FINDTLV RESP "9F77" RESP

// Get Data
SET CMD "80CA9F7800"
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT
FINDTLV RESP "9F78" RESP

// Get Data
SET CMD "80CA9F7900"
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT
FINDTLV RESP "9F79" RESP

// Get Data
SET CMD "80CA9F6B00"
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT
FINDTLV RESP "9F6B" RESP

// Get Data
SET CMD "80CA9F6D00"
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT
FINDTLV RESP "9F6D" RESP

// =======================================transaction 21=======================================
// RESET
POWERON USERCARD RESP
SET P2 0

// SELECT PPSE
SET AID "325041592E5359532E4444463031"
GPSELECT USERCARD AID RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT

// SELECT PBOC
SET AID "A0000003330101"
GPSELECT USERCARD AID RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT

// GPO
SET PDOL_DATA "831026000080000000000400A8EBC5F20344"
APPEND CMD "80A8000012" PDOL_DATA
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT

LEFT TEMP RESP 2
JE TEMP "77" TRANSACTION21_GPO_RESPONSE_TAG_77
MID AIP RESP 5 4
MID AFL RESP 9
JMP TRANSACTION21_GPO_RESPONSE_TAG_77_END
TRANSACTION21_GPO_RESPONSE_TAG_77:

FINDTLV AIP "82" RESP
FINDTLV AFL "94" RESP
FINDTLV ATC "9F36" RESP
FINDTLV IAD "9F10" RESP
MID CVR IAD 7 8
TRANSACTION21_GPO_RESPONSE_TAG_77_END:

// Read Record
SET CMD "00B2011C00"
SENDAPDU USERCARD CMD RESP SW "9000"

// Read Record
SET CMD "00B2050C00"
SENDAPDU USERCARD CMD RESP SW "9000"

// Read Record
SET CMD "00B2031400"
SENDAPDU USERCARD CMD RESP SW "9000"

// Read Record
SET CMD "00B2041400"
SENDAPDU USERCARD CMD RESP SW "9000"

// Read Record
SET CMD "00B2051400"
SENDAPDU USERCARD CMD RESP SW "9000"

// Read Record
SET CMD "00B2061400"
SENDAPDU USERCARD CMD RESP SW "9000"

// Read Record
SET CMD "00B2071400"
SENDAPDU USERCARD CMD RESP SW "9000"

// Read Record
SET CMD "00B2012400"
SENDAPDU USERCARD CMD RESP SW "9000"

// Read Record
SET CMD "00B2032C00"
SENDAPDU USERCARD CMD RESP SW "9000"

// Get Data
SET CMD "80CA9F7700"
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT
FINDTLV RESP "9F77" RESP

// Get Data
SET CMD "80CA9F7800"
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT
FINDTLV RESP "9F78" RESP

// Get Data
SET CMD "80CA9F7900"
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT
FINDTLV RESP "9F79" RESP

// Get Data
SET CMD "80CA9F6B00"
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT
FINDTLV RESP "9F6B" RESP

// Get Data
SET CMD "80CA9F6D00"
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT
FINDTLV RESP "9F6D" RESP

// Get Data
SET CMD "80CA9F5D00"
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT
FINDTLV RESP "9F5D" RESP

// =======================================transaction 22=======================================
// RESET
POWERON USERCARD RESP
SET P2 0

// SELECT PPSE
SET AID "325041592E5359532E4444463031"
GPSELECT USERCARD AID RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT

// SELECT PBOC
SET AID "A0000003330101"
GPSELECT USERCARD AID RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT

// GPO
SET PDOL_DATA "831026000080000000000200A8EBC5F30156"
APPEND CMD "80A8000012" PDOL_DATA
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT

LEFT TEMP RESP 2
JE TEMP "77" TRANSACTION22_GPO_RESPONSE_TAG_77
MID AIP RESP 5 4
MID AFL RESP 9
JMP TRANSACTION22_GPO_RESPONSE_TAG_77_END
TRANSACTION22_GPO_RESPONSE_TAG_77:

FINDTLV AIP "82" RESP
FINDTLV AFL "94" RESP
FINDTLV ATC "9F36" RESP
FINDTLV IAD "9F10" RESP
MID CVR IAD 7 8
TRANSACTION22_GPO_RESPONSE_TAG_77_END:

// Read Record
SET CMD "00B2011C00"
SENDAPDU USERCARD CMD RESP SW "9000"

// Read Record
SET CMD "00B2050C00"
SENDAPDU USERCARD CMD RESP SW "9000"

// Read Record
SET CMD "00B2031400"
SENDAPDU USERCARD CMD RESP SW "9000"

// Read Record
SET CMD "00B2041400"
SENDAPDU USERCARD CMD RESP SW "9000"

// Read Record
SET CMD "00B2051400"
SENDAPDU USERCARD CMD RESP SW "9000"

// Read Record
SET CMD "00B2061400"
SENDAPDU USERCARD CMD RESP SW "9000"

// Read Record
SET CMD "00B2071400"
SENDAPDU USERCARD CMD RESP SW "9000"

// Read Record
SET CMD "00B2012400"
SENDAPDU USERCARD CMD RESP SW "9000"

// Read Record
SET CMD "00B2032C00"
SENDAPDU USERCARD CMD RESP SW "9000"

// =======================================transaction 23=======================================
// RESET
POWERON USERCARD RESP
SET P2 0

// SELECT PPSE
SET AID "325041592E5359532E4444463031"
GPSELECT USERCARD AID RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT

// SELECT PBOC
SET AID "A0000003330101"
GPSELECT USERCARD AID RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT

// Get Data
SET CMD "80CA9F7700"
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT
FINDTLV RESP "9F77" RESP

// Get Data
SET CMD "80CA9F7800"
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT
FINDTLV RESP "9F78" RESP

// Get Data
SET CMD "80CA9F7900"
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT
FINDTLV RESP "9F79" RESP

// Get Data
SET CMD "80CA9F6B00"
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT
FINDTLV RESP "9F6B" RESP

// Get Data
SET CMD "80CA9F6D00"
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT
FINDTLV RESP "9F6D" RESP

// Get Data
SET CMD "80CA9F5D00"
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT
FINDTLV RESP "9F5D" RESP

// GPO
SET PDOL_DATA "8310F6000000000000000200A8EBC6AA0840"
APPEND CMD "80A8000012" PDOL_DATA
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT

LEFT TEMP RESP 2
JE TEMP "77" TRANSACTION23_GPO_RESPONSE_TAG_77
MID AIP RESP 5 4
MID AFL RESP 9
JMP TRANSACTION23_GPO_RESPONSE_TAG_77_END
TRANSACTION23_GPO_RESPONSE_TAG_77:

FINDTLV AIP "82" RESP
FINDTLV AFL "94" RESP
FINDTLV ATC "9F36" RESP
FINDTLV IAD "9F10" RESP
MID CVR IAD 7 8
TRANSACTION23_GPO_RESPONSE_TAG_77_END:

// Read Record
SET CMD "00B2010C00"
SENDAPDU USERCARD CMD RESP SW "9000"

// Read Record
SET CMD "00B2020C00"
SENDAPDU USERCARD CMD RESP SW "9000"

// Read Record
SET CMD "00B2050C00"
SENDAPDU USERCARD CMD RESP SW "9000"

// Read Record
SET CMD "00B2031400"
SENDAPDU USERCARD CMD RESP SW "9000"

// Read Record
SET CMD "00B2041400"
SENDAPDU USERCARD CMD RESP SW "9000"

// Read Record
SET CMD "00B2051400"
SENDAPDU USERCARD CMD RESP SW "9000"

// Read Record
SET CMD "00B2061400"
SENDAPDU USERCARD CMD RESP SW "9000"

// Read Record
SET CMD "00B2071400"
SENDAPDU USERCARD CMD RESP SW "9000"

// Read Record
SET CMD "00B2012400"
SENDAPDU USERCARD CMD RESP SW "9000"

// Get Data
SET CMD "80CA9F1700"
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT
FINDTLV RESP "9F17" RESP

// Verify Pin
APPEND CMD "0020008008" "241234FFFFFFFFFF"
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT

// 1st Generate AC
SET CDOL1_DATA "00000000020000000000000001560000000000084018071109120000A8EBC6AA"
APPEND CMD "80AE800020" CDOL1_DATA
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT

LEFT TEMP RESP 2
JE TEMP "77" TRANSACTION23_1st_GENERATE_AC_TAG_77
MID ATC RESP 7 4
MID RESP_AC1 RESP 11 16
MID CVR RESP 33 8

JMP TRANSACTION23_1st_GENERATE_AC_TAG_77_END
TRANSACTION23_1st_GENERATE_AC_TAG_77:
FINDTLV ATC "9F36" RESP
FINDTLV RESP_AC1 "9F36" RESP
FINDTLV IAD "9F36" RESP
TRANSACTION23_1st_GENERATE_AC_TAG_77_END:

NOT TEMP ATC
APPEND DATA "000000000000" ATC "000000000000" TEMP
CIPHER SESK DATA UDK TDES_ENC_ECB

APPEND TEMP "000000000200000000000000015600000000000840180711" "00A8EBC6AA"
APPEND DATA TEMP AIP ATC CVR
PADDING DATA DATA PAD_ISO9797_M2
CIPHER CAC DATA SESK DES_TDES_MAC
COMPARE CAC RESP_AC1 0

// 2nd Generate AC
SET CDOL2_DATA "303000000000020000000000000001560000000000084018071109120000A8EBC6AA"
APPEND CMD "80AE400022" CDOL2_DATA
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT

LEFT TEMP RESP 2
JE TEMP "77" TRANSACTION23_2nd_GENERATE_AC_TAG_77
MID ATC RESP 7 4
MID RESP_AC2 RESP 11 16
MID CVR RESP 33 8

JMP TRANSACTION23_2nd_GENERATE_AC_TAG_77_END
TRANSACTION23_2nd_GENERATE_AC_TAG_77:
FINDTLV ATC "9F36" RESP
FINDTLV RESP_AC2 "9F36" RESP
FINDTLV IAD "9F36" RESP
TRANSACTION23_2nd_GENERATE_AC_TAG_77_END:

APPEND TEMP "000000000200000000000000015600000000000840180711" "00A8EBC6AA"
APPEND DATA TEMP AIP ATC CVR
PADDING DATA DATA PAD_ISO9797_M2
CIPHER CAC DATA SESK DES_TDES_MAC
COMPARE CAC RESP_AC2 0

// Get Data
SET CMD "80CA9F5600"
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT
FINDTLV RESP "9F56" RESP

// Get Data
SET CMD "80CA9F7700"
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT
FINDTLV RESP "9F77" RESP

// Get Data
SET CMD "80CA9F7800"
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT
FINDTLV RESP "9F78" RESP

// Get Data
SET CMD "80CA9F7900"
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT
FINDTLV RESP "9F79" RESP

// Get Data
SET CMD "80CA9F6B00"
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT
FINDTLV RESP "9F6B" RESP

// Get Data
SET CMD "80CA9F6D00"
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT
FINDTLV RESP "9F6D" RESP

// =======================================transaction 24=======================================
// RESET
POWERON USERCARD RESP
SET P2 0

// SELECT PPSE
SET AID "325041592E5359532E4444463031"
GPSELECT USERCARD AID RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT

// SELECT PBOC
SET AID "A0000003330101"
GPSELECT USERCARD AID RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT

// GPO
SET PDOL_DATA "831026000080000000000200A8EBC6AB0156"
APPEND CMD "80A8000012" PDOL_DATA
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT

LEFT TEMP RESP 2
JE TEMP "77" TRANSACTION24_GPO_RESPONSE_TAG_77
MID AIP RESP 5 4
MID AFL RESP 9
JMP TRANSACTION24_GPO_RESPONSE_TAG_77_END
TRANSACTION24_GPO_RESPONSE_TAG_77:

FINDTLV AIP "82" RESP
FINDTLV AFL "94" RESP
FINDTLV ATC "9F36" RESP
FINDTLV IAD "9F10" RESP
MID CVR IAD 7 8
TRANSACTION24_GPO_RESPONSE_TAG_77_END:

// Read Record
SET CMD "00B2011C00"
SENDAPDU USERCARD CMD RESP SW "9000"

// Read Record
SET CMD "00B2050C00"
SENDAPDU USERCARD CMD RESP SW "9000"

// Read Record
SET CMD "00B2031400"
SENDAPDU USERCARD CMD RESP SW "9000"

// Read Record
SET CMD "00B2041400"
SENDAPDU USERCARD CMD RESP SW "9000"

// Read Record
SET CMD "00B2051400"
SENDAPDU USERCARD CMD RESP SW "9000"

// Read Record
SET CMD "00B2061400"
SENDAPDU USERCARD CMD RESP SW "9000"

// Read Record
SET CMD "00B2071400"
SENDAPDU USERCARD CMD RESP SW "9000"

// Read Record
SET CMD "00B2012400"
SENDAPDU USERCARD CMD RESP SW "9000"

// Read Record
SET CMD "00B2032C00"
SENDAPDU USERCARD CMD RESP SW "9000"

// Get Data
SET CMD "80CA9F7700"
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT
FINDTLV RESP "9F77" RESP

// Get Data
SET CMD "80CA9F7800"
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT
FINDTLV RESP "9F78" RESP

// Get Data
SET CMD "80CA9F7900"
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT
FINDTLV RESP "9F79" RESP

// Get Data
SET CMD "80CA9F6B00"
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT
FINDTLV RESP "9F6B" RESP

// Get Data
SET CMD "80CA9F6D00"
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT
FINDTLV RESP "9F6D" RESP

// Get Data
SET CMD "80CA9F5D00"
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT
FINDTLV RESP "9F5D" RESP

// =======================================transaction 25=======================================
// RESET
POWERON USERCARD RESP
SET P2 0

// SELECT PPSE
SET AID "325041592E5359532E4444463031"
GPSELECT USERCARD AID RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT

// SELECT PBOC
SET AID "A0000003330101"
GPSELECT USERCARD AID RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT

// GPO
SET PDOL_DATA "8310F6000000000000000200A8EBC6A90156"
APPEND CMD "80A8000012" PDOL_DATA
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT

LEFT TEMP RESP 2
JE TEMP "77" TRANSACTION25_GPO_RESPONSE_TAG_77
MID AIP RESP 5 4
MID AFL RESP 9
JMP TRANSACTION25_GPO_RESPONSE_TAG_77_END
TRANSACTION25_GPO_RESPONSE_TAG_77:

FINDTLV AIP "82" RESP
FINDTLV AFL "94" RESP
FINDTLV ATC "9F36" RESP
FINDTLV IAD "9F10" RESP
MID CVR IAD 7 8
TRANSACTION25_GPO_RESPONSE_TAG_77_END:

// Read Record
SET CMD "00B2010C00"
SENDAPDU USERCARD CMD RESP SW "9000"

// Read Record
SET CMD "00B2020C00"
SENDAPDU USERCARD CMD RESP SW "9000"

// Read Record
SET CMD "00B2050C00"
SENDAPDU USERCARD CMD RESP SW "9000"

// Read Record
SET CMD "00B2031400"
SENDAPDU USERCARD CMD RESP SW "9000"

// Read Record
SET CMD "00B2041400"
SENDAPDU USERCARD CMD RESP SW "9000"

// Read Record
SET CMD "00B2051400"
SENDAPDU USERCARD CMD RESP SW "9000"

// Read Record
SET CMD "00B2061400"
SENDAPDU USERCARD CMD RESP SW "9000"

// Read Record
SET CMD "00B2071400"
SENDAPDU USERCARD CMD RESP SW "9000"

// Read Record
SET CMD "00B2012400"
SENDAPDU USERCARD CMD RESP SW "9000"

// Get Data
SET CMD "80CA9F1700"
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT
FINDTLV RESP "9F17" RESP

// Verify Pin
APPEND CMD "0020008008" "241234FFFFFFFFFF"
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT

// 1st Generate AC
SET CDOL1_DATA "00000000020000000000000001560000000000015618071109120300A8EBC6A9"
APPEND CMD "80AE800020" CDOL1_DATA
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT

LEFT TEMP RESP 2
JE TEMP "77" TRANSACTION25_1st_GENERATE_AC_TAG_77
MID ATC RESP 7 4
MID RESP_AC1 RESP 11 16
MID CVR RESP 33 8

JMP TRANSACTION25_1st_GENERATE_AC_TAG_77_END
TRANSACTION25_1st_GENERATE_AC_TAG_77:
FINDTLV ATC "9F36" RESP
FINDTLV RESP_AC1 "9F36" RESP
FINDTLV IAD "9F36" RESP
TRANSACTION25_1st_GENERATE_AC_TAG_77_END:

NOT TEMP ATC
APPEND DATA "000000000000" ATC "000000000000" TEMP
CIPHER SESK DATA UDK TDES_ENC_ECB

APPEND TEMP "000000000200000000000000015600000000000156180711" "00A8EBC6A9"
APPEND DATA TEMP AIP ATC CVR
PADDING DATA DATA PAD_ISO9797_M2
CIPHER CAC DATA SESK DES_TDES_MAC
COMPARE CAC RESP_AC1 0

// External Authenticate
NOT TEMP ATC
APPEND DATA "000000000000" ATC "000000000000" TEMP
CIPHER SESK DATA UDK TDES_ENC_ECB
APPEND DATA "3030" "000000000000"
XOR DATA CAC DATA
APPEND DATA DATA "0000000000000000"
CIPHER ARQC DATA SESK TDES_ENC_ECB
LEFT ARQC ARQC 16
APPEND CMD "008200000A" ARQC "3030"
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT

// 2nd Generate AC
SET CDOL2_DATA "303000000000020000000000000001560000000000015618071109120300A8EBC6A9"
APPEND CMD "80AE400022" CDOL2_DATA
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT

LEFT TEMP RESP 2
JE TEMP "77" TRANSACTION25_2nd_GENERATE_AC_TAG_77
MID ATC RESP 7 4
MID RESP_AC2 RESP 11 16
MID CVR RESP 33 8

JMP TRANSACTION25_2nd_GENERATE_AC_TAG_77_END
TRANSACTION25_2nd_GENERATE_AC_TAG_77:
FINDTLV ATC "9F36" RESP
FINDTLV RESP_AC2 "9F36" RESP
FINDTLV IAD "9F36" RESP
TRANSACTION25_2nd_GENERATE_AC_TAG_77_END:

APPEND TEMP "000000000200000000000000015600000000000156180711" "00A8EBC6A9"
APPEND DATA TEMP AIP ATC CVR
PADDING DATA DATA PAD_ISO9797_M2
CIPHER CAC DATA SESK DES_TDES_MAC
COMPARE CAC RESP_AC2 0

// Make Session Key
NOT TEMP ATC
APPEND DATA "000000000000" ATC "000000000000" TEMP
CIPHER SESK DATA MDK TDES_ENC_ECB
// Put Data
SET CMD "04DA9F6B0A"
APPEND DATA CMD ATC RESP_AC1 "000000000500"
PADDING DATA DATA PAD_ISO9797_M2
CIPHER MAC DATA SESK DES_TDES_MAC
LEFT MAC MAC 8
APPEND CMD CMD "000000000500" MAC
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT

// Get Data
SET CMD "80CA9F6B00"
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT
FINDTLV RESP "9F6B" RESP

// Make Session Key
NOT TEMP ATC
APPEND DATA "000000000000" ATC "000000000000" TEMP
CIPHER SESK DATA MDK TDES_ENC_ECB
// Put Data
SET CMD "04DA9F6D0A"
APPEND DATA CMD ATC RESP_AC1 "000000001500"
PADDING DATA DATA PAD_ISO9797_M2
CIPHER MAC DATA SESK DES_TDES_MAC
LEFT MAC MAC 8
APPEND CMD CMD "000000001500" MAC
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT

// Get Data
SET CMD "80CA9F6D00"
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT
FINDTLV RESP "9F6D" RESP

// Make Session Key
NOT TEMP ATC
APPEND DATA "000000000000" ATC "000000000000" TEMP
CIPHER SESK DATA MDK TDES_ENC_ECB
// Put Data
SET CMD "04DADF720A"
APPEND DATA CMD ATC RESP_AC1 "000000000500"
PADDING DATA DATA PAD_ISO9797_M2
CIPHER MAC DATA SESK DES_TDES_MAC
LEFT MAC MAC 8
APPEND CMD CMD "000000000500" MAC
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT

// Get Data
SET CMD "80CADF7200"
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT
FINDTLV RESP "DF72" RESP

// Make Session Key
NOT TEMP ATC
APPEND DATA "000000000000" ATC "000000000000" TEMP
CIPHER SESK DATA MDK TDES_ENC_ECB
// Put Data
SET CMD "04DADF760A"
APPEND DATA CMD ATC RESP_AC1 "000000003000"
PADDING DATA DATA PAD_ISO9797_M2
CIPHER MAC DATA SESK DES_TDES_MAC
LEFT MAC MAC 8
APPEND CMD CMD "000000003000" MAC
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT

// Get Data
SET CMD "80CADF7600"
SENDAPDU USERCARD CMD RESP SW "9000"
JNE SW "9000" ERROR_SCRIPT
FINDTLV RESP "DF76" RESP


ERROR_SCRIPT:
